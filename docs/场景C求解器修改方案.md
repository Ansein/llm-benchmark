# åœºæ™¯Cæ±‚è§£å™¨ä¿®æ”¹æ–¹æ¡ˆ

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1 (å·²ä¿®æ­£)  
**åˆ›å»ºæ—¥æœŸ**: 2026-01-28  
**ä¿®æ­£æ—¥æœŸ**: 2026-01-28  
**è®ºæ–‡**: "The Economics of Social Data" (Bergemann, Bonatti, Gan, 2022)

---

## âš ï¸ é‡è¦æ›´æ­£è¯´æ˜

**åŸç‰ˆæœ¬é”™è¯¯**ï¼šè®¤ä¸ºè®ºæ–‡ä½¿ç”¨ç»Ÿä¸€è¡¥å¿mï¼Œä¸ªæ€§åŒ–è¡¥å¿m_iæ˜¯"æ‰©å±•"ã€‚

**å®é™…æƒ…å†µ**ï¼šä»”ç»†æ£€æŸ¥è®ºæ–‡åå‘ç°ï¼š
- âœ… è®ºæ–‡**æ ‡å‡†æ¨¡å‹ä½¿ç”¨ä¸ªæ€§åŒ–è¡¥å¿m_i**ï¼ˆè§å¼(4), (11), Proposition 5ï¼‰
- âŒ æˆ‘ä»¬å½“å‰å®ç°ç®€åŒ–ä¸ºç»Ÿä¸€è¡¥å¿mï¼Œ**åç¦»äº†è®ºæ–‡è®¾å®š**
- ğŸ”´ **ä¿®æ”¹1çš„ä¼˜å…ˆçº§ä»P2ï¼ˆå¯é€‰æ‰©å±•ï¼‰æå‡è‡³P0ï¼ˆå¿…éœ€ä¿®æ­£ï¼‰**

æœ¬æ–‡æ¡£å·²å…¨é¢ä¿®æ­£ï¼Œåæ˜ æ­£ç¡®çš„è®ºæ–‡ç†è§£ã€‚

---

## ä¸€ã€ä¿®æ”¹æ¦‚è¿°

é’ˆå¯¹åœºæ™¯Cï¼ˆç¤¾ä¼šæ•°æ®ç»æµå­¦ï¼‰çš„æ±‚è§£å™¨ï¼Œæˆ‘ä»¬æå‡ºä¸‰é¡¹å…³é”®ä¿®æ”¹ï¼Œä»¥**ä¿®æ­£å½“å‰å®ç°ä¸è®ºæ–‡çš„åç¦»**ï¼Œå¹¶æå‡å·¥ç¨‹å¯è¡Œæ€§ï¼š

| ä¿®æ”¹é¡¹ | ç±»å‹ | ä¼˜å…ˆçº§ | ç†è®ºä¾æ® |
|--------|------|--------|----------|
| **ä¿®æ”¹1**: mä¸ªæ€§åŒ–ï¼ˆnç»´å‘é‡ï¼‰ | âš ï¸ **ç†è®ºå¯¹é½ï¼ˆå¿…éœ€ï¼‰** | ğŸ”´ é«˜ | Section 2.3, Eq.(4), (11), Proposition 5 |
| **ä¿®æ”¹2**: ä¸­ä»‹åˆ©æ¶¦çº¦æŸï¼ˆR>0ï¼‰ | ç†è®ºå®Œå–„ | ğŸŸ¢ é«˜ | ç†æ€§å‚ä¸çº¦æŸ |
| **ä¿®æ”¹3**: è¿­ä»£å†å²ä¿¡æ¯ä¼˜åŒ– | å·¥ç¨‹ä¼˜åŒ– | ğŸŸ¢ é«˜ | Large Markets (Section 4.2) |

âš ï¸ **é‡è¦å‘ç°**ï¼šä¿®æ”¹1ä¸æ˜¯"æ‰©å±•"ï¼Œè€Œæ˜¯**ä¿®æ­£å½“å‰å®ç°çš„ç†è®ºåç¦»**ã€‚è®ºæ–‡æ ‡å‡†æ¨¡å‹ä½¿ç”¨ä¸ªæ€§åŒ–è¡¥å¿m_iï¼Œè€Œæˆ‘ä»¬å½“å‰å®ç°ç®€åŒ–ä¸ºç»Ÿä¸€è¡¥å¿mã€‚

---

## äºŒã€ä¿®æ”¹1ï¼šmçš„ä¸ªæ€§åŒ–ï¼ˆnç»´å‘é‡ï¼‰

### 2.1 ç†è®ºä¾æ®ï¼ˆâ—è®ºæ–‡æ ‡å‡†è®¾å®šï¼‰

**âš ï¸ å…³é”®å‘ç°**ï¼šè®ºæ–‡çš„**æ ‡å‡†æ¨¡å‹å°±æ˜¯ä¸ªæ€§åŒ–è¡¥å¿m_i**ï¼Œä¸æ˜¯ç»Ÿä¸€è¡¥å¿mï¼

**è®ºæ–‡Section 2.3** (Data Market, p.10):

> "The data contract with consumer i specifies a data inflow policy Xi and a fee **mi âˆˆ R** paid to the consumer."  
> ï¼ˆç¬¬362è¡Œï¼‰

**è®ºæ–‡å¼(4)** (Intermediary's Revenue):

> "R = m0 âˆ’ **Î£^N_{i=1} mi**"  
> ï¼ˆç¬¬394è¡Œï¼‰

**è®ºæ–‡å¼(11)** (Optimal Compensation):

> "m*_i(X) = Ui((Si, Xâˆ’i), Xâˆ’i) âˆ’ Ui((Si, X), X)"  
> ï¼ˆç¬¬654è¡Œï¼‰

**è®ºæ–‡Proposition 5** (Large Markets, p.25):

> "As N â†’ âˆ:  
> 1. Each consumer's compensation **m*_i** converges to zero.  
> 2. Total consumer compensation is bounded by a constant, NÂ·**m*_i** â‰¤ (9/8)(var[Î¸_i] + var[Îµ_i]), âˆ€N."

**ç»æµå­¦ç›´è§‰**ï¼š
- è®ºæ–‡å¼(11)è¡¨æ˜ï¼šm*_iå–å†³äºæ¶ˆè´¹è€…içš„**è¾¹é™…è´¡çŒ®** = å¥¹é€€å‡ºæ—¶çš„æ•ˆç”¨æŸå¤±
- ä¸åŒæ¶ˆè´¹è€…çš„Ï„_iå¼‚è´¨ â†’ è¾¹é™…è´¡çŒ®ä¸åŒ â†’ **æœ€ä¼˜è¡¥å¿å¿…ç„¶ä¸ªæ€§åŒ–**
- è¿™æ˜¯æ ‡å‡†çš„Shapleyå€¼åˆ†é…æˆ–è¾¹é™…è´¡çŒ®å®šä»·

### 2.2 å½“å‰å®ç°ï¼ˆâš ï¸ åç¦»è®ºæ–‡ï¼‰

```python
# src/scenarios/scenario_c_social_data.py, Line ~270
@dataclass
class ScenarioCParams:
    """åœºæ™¯Cå‚æ•°é…ç½®ç±»"""
    N: int                    # æ¶ˆè´¹è€…æ•°é‡
    m: float                  # âŒ ç»Ÿä¸€è¡¥å¿ï¼ˆæ ‡é‡ï¼‰- è®ºæ–‡ç”¨m_iå‘é‡ï¼
    anonymization: str
    # ... å…¶ä»–å‚æ•°
```

```python
# src/scenarios/scenario_c_social_data.py, Line ~1410
def simulate_market_outcome(...):
    # âŒ è®¡ç®—ä¸­ä»‹æˆæœ¬ï¼ˆç»Ÿä¸€è¡¥å¿ï¼‰- è®ºæ–‡å¼(4)ç”¨Î£m_iï¼
    intermediary_cost = params.m * num_participants
    intermediary_profit = m0 - intermediary_cost
```

**ä¸¥é‡é—®é¢˜ï¼ˆç†è®ºåç¦»ï¼‰**ï¼š
1. âŒ **ç›´æ¥è¿åè®ºæ–‡å¼(4), (11)çš„å®šä¹‰** - è®ºæ–‡æ˜ç¡®ä½¿ç”¨m_i
2. âŒ **æ— æ³•å®ç°è®ºæ–‡å¼(11)çš„æœ€ä¼˜è¡¥å¿** - m*_i = Ui((Si, Xâˆ’i), Xâˆ’i) âˆ’ Ui((Si, X), X)
3. âŒ **Proposition 5æ— æ³•éªŒè¯** - è®ºæ–‡è®¨è®ºçš„æ˜¯NÂ·m*_içš„æ”¶æ•›æ€§ï¼Œè€ŒéNÂ·m
4. âŒ **ä½ä¼°ä¸­ä»‹æœ€ä¼˜åˆ©æ¶¦** - ç»Ÿä¸€è¡¥å¿æ— æ³•åˆ©ç”¨æ¶ˆè´¹è€…å¼‚è´¨æ€§

### 2.3 ä¿®æ”¹æ–¹æ¡ˆï¼ˆä¸ªæ€§åŒ–è¡¥å¿ï¼‰

#### æ–¹æ¡ˆAï¼šå®Œå…¨ä¸ªæ€§åŒ–ï¼ˆè¿ç»­ä¼˜åŒ–ï¼‰

```python
# ä¿®æ”¹ï¼šå‚æ•°ç±»æ”¯æŒå‘é‡è¡¥å¿
@dataclass
class ScenarioCParams:
    N: int
    m: Union[float, np.ndarray]  # æ”¯æŒæ ‡é‡æˆ–nç»´å‘é‡
    anonymization: str
    # ... å…¶ä»–å‚æ•°
    
    def __post_init__(self):
        # è‡ªåŠ¨æ‰©å±•æ ‡é‡ä¸ºå‘é‡
        if isinstance(self.m, (int, float)):
            self.m = np.full(self.N, float(self.m))
        else:
            self.m = np.array(self.m)
            assert len(self.m) == self.N, "mç»´åº¦å¿…é¡»ç­‰äºN"
```

```python
# ä¿®æ”¹ï¼šå¸‚åœºæ¨¡æ‹Ÿæ”¯æŒä¸ªæ€§åŒ–è¡¥å¿
def simulate_market_outcome(
    data: ConsumerData,
    participation: np.ndarray,
    params: ScenarioCParams,
    ...
) -> MarketOutcome:
    # è®¡ç®—ä¸ªæ€§åŒ–è¡¥å¿æ€»æˆæœ¬
    intermediary_cost = np.sum(params.m[participation])
    intermediary_profit = m0 - intermediary_cost
    
    # è®¡ç®—æ•ˆç”¨æ—¶ä½¿ç”¨ä¸ªæ€§åŒ–è¡¥å¿
    for i in range(params.N):
        if participation[i]:
            utilities[i] += params.m[i]  # æ¯äººè·å¾—ä¸åŒè¡¥å¿
```

```python
# ä¿®æ”¹ï¼šä½¿ç”¨SGDä¼˜åŒ–må‘é‡
def optimize_intermediary_policy_personalized(
    params_base: Dict,
    num_iterations: int = 100,
    learning_rate: float = 0.01,
    seed: Optional[int] = None
) -> OptimalPolicy:
    """
    ä½¿ç”¨éšæœºæ¢¯åº¦ä¸‹é™ä¼˜åŒ–ä¸ªæ€§åŒ–è¡¥å¿å‘é‡m
    
    ç›®æ ‡å‡½æ•°ï¼šmax_m  E[R(m)] = E[m_0(m) - Î£_i m_i Â· a_i(m)]
    çº¦æŸï¼šm_i â‰¥ 0, âˆ€i
    
    ç®—æ³•ï¼š
    1. åˆå§‹åŒ–ï¼šm^(0) = [m_init, ..., m_init]
    2. è¿­ä»£ï¼šå¯¹äºt = 1, ..., T
       a) é‡‡æ ·ä¸–ç•ŒçŠ¶æ€(w, s, Ï„)
       b) è®¡ç®—æ¢¯åº¦ï¼šâˆ‡_m R(m^(t))
       c) æ›´æ–°ï¼šm^(t+1) = max(0, m^(t) + Î·Â·âˆ‡_m R)
    3. è¿”å›ï¼šm* = m^(T)
    """
    N = params_base['N']
    rng = np.random.default_rng(seed)
    
    # åˆå§‹åŒ–ï¼šç»Ÿä¸€è¡¥å¿
    m_vec = np.full(N, 1.0)
    
    # è·å–æ¶ˆè´¹è€…éšç§æˆæœ¬ï¼ˆç”¨äºæ¢¯åº¦ä¼°è®¡ï¼‰
    tau_samples = sample_privacy_costs(params_base, size=N, rng=rng)
    
    for t in range(num_iterations):
        # 1. å‰å‘ä¼ æ’­ï¼šè®¡ç®—å½“å‰mä¸‹çš„åˆ©æ¶¦
        params = ScenarioCParams(m=m_vec.copy(), **params_base)
        
        # ä¼°è®¡å‚ä¸ç‡å’Œåˆ©æ¶¦
        result = evaluate_intermediary_strategy(
            m=m_vec,
            params_base=params_base,
            num_mc_samples=20
        )
        
        # 2. è®¡ç®—æ¢¯åº¦ï¼ˆæœ‰é™å·®åˆ†è¿‘ä¼¼ï¼‰
        gradient = np.zeros(N)
        epsilon = 0.01
        
        for i in range(N):
            # m_iå¾®å°æ‰°åŠ¨
            m_perturb = m_vec.copy()
            m_perturb[i] += epsilon
            
            params_perturb = ScenarioCParams(m=m_perturb, **params_base)
            result_perturb = evaluate_intermediary_strategy(
                m=m_perturb,
                params_base=params_base,
                num_mc_samples=20
            )
            
            # æ•°å€¼æ¢¯åº¦ï¼šâˆ‚R/âˆ‚m_i
            gradient[i] = (result_perturb.intermediary_profit - 
                          result.intermediary_profit) / epsilon
        
        # 3. æ¢¯åº¦ä¸Šå‡ï¼ˆæœ€å¤§åŒ–åˆ©æ¶¦ï¼‰
        m_vec = np.maximum(0, m_vec + learning_rate * gradient)
        
        # 4. æ—©åœæ£€æŸ¥
        if np.linalg.norm(gradient) < 1e-3:
            break
    
    return OptimalPolicy(
        m_star=m_vec,  # è¿”å›å‘é‡
        anonymization_star=result.anonymization,
        intermediary_profit=result.intermediary_profit
    )
```

#### æ–¹æ¡ˆBï¼šç¦»æ•£ç±»å‹ï¼ˆç®€åŒ–ç‰ˆï¼Œæ¨èï¼‰

```python
# ç®€åŒ–ï¼šå°†æ¶ˆè´¹è€…åˆ†ä¸ºKä¸ªç±»å‹ï¼ˆå¦‚K=3: ä½/ä¸­/é«˜éšç§æˆæœ¬ï¼‰
def optimize_intermediary_policy_discrete_types(
    params_base: Dict,
    K: int = 3,  # ç±»å‹æ•°
    seed: Optional[int] = None
) -> OptimalPolicy:
    """
    å¯¹Kä¸ªç¦»æ•£ç±»å‹ä¼˜åŒ–è¡¥å¿ï¼ˆé™ç»´ï¼šä»Nç»´åˆ°Kç»´ï¼‰
    
    æ­¥éª¤ï¼š
    1. æ ¹æ®Ï„_iå°†æ¶ˆè´¹è€…èšç±»ä¸ºKä¸ªç±»å‹
    2. ç½‘æ ¼æœç´¢æœ€ä¼˜è¡¥å¿ç»„åˆ (m_1, ..., m_K)
    3. ç±»å‹kçš„æ¶ˆè´¹è€…è·å¾—è¡¥å¿m_k
    """
    N = params_base['N']
    rng = np.random.default_rng(seed)
    
    # 1. èšç±»ï¼šæ ¹æ®Ï„åˆ†å¸ƒåˆ’åˆ†ç±»å‹
    tau_mean = params_base['tau_mean']
    tau_std = params_base['tau_std']
    
    # ä¾‹å¦‚ï¼šä½Ï„: [0, Î¼-Ïƒ], ä¸­Ï„: [Î¼-Ïƒ, Î¼+Ïƒ], é«˜Ï„: [Î¼+Ïƒ, âˆ]
    tau_thresholds = np.linspace(
        tau_mean - tau_std,
        tau_mean + tau_std,
        K - 1
    )
    
    def assign_type(tau_i):
        """åˆ†é…æ¶ˆè´¹è€…ç±»å‹"""
        for k, threshold in enumerate(tau_thresholds):
            if tau_i < threshold:
                return k
        return K - 1
    
    # 2. ç½‘æ ¼æœç´¢Kç»´ç©ºé—´
    m_grid_1d = np.linspace(0, 3.0, 15)  # æ¯ç»´15ä¸ªç‚¹
    m_combinations = itertools.product(m_grid_1d, repeat=K)
    
    best_profit = -np.inf
    best_m_types = None
    
    for m_types in m_combinations:
        # æ„å»ºNç»´å‘é‡ï¼šæ ¹æ®ç±»å‹åˆ†é…è¡¥å¿
        m_vec = np.zeros(N)
        tau_samples = sample_privacy_costs(params_base, N, rng)
        
        for i in range(N):
            type_k = assign_type(tau_samples[i])
            m_vec[i] = m_types[type_k]
        
        # è¯„ä¼°è¯¥è¡¥å¿å‘é‡
        result = evaluate_intermediary_strategy(
            m=m_vec,
            params_base=params_base,
            num_mc_samples=30
        )
        
        if result.intermediary_profit > best_profit:
            best_profit = result.intermediary_profit
            best_m_types = m_types
    
    return OptimalPolicy(
        m_star=best_m_types,  # Kç»´å‘é‡
        intermediary_profit=best_profit
    )
```

### 2.4 å®æ–½å»ºè®®ï¼ˆâ—ä¿®æ­£ä¼˜å…ˆçº§ï¼‰

**âš ï¸ é‡æ–°è¯„ä¼°**ï¼šé‰´äºè®ºæ–‡æ ‡å‡†æ¨¡å‹å°±æ˜¯m_iï¼Œä¿®æ”¹1çš„ä¼˜å…ˆçº§åº”**å¤§å¹…æå‡**ï¼

**ä¿®æ­£åçš„æ¨èè·¯å¾„**ï¼š

1. **Phase 1ï¼ˆå¿…éœ€ï¼‰**ï¼šå®ç°æ–¹æ¡ˆBï¼ˆç¦»æ•£ç±»å‹ï¼‰
   - **ç†ç”±**ï¼šå›å½’è®ºæ–‡æ ‡å‡†è®¾å®šï¼Œä¿®æ­£ç†è®ºåç¦»
   - **ç›®æ ‡**ï¼šå®ç°è®ºæ–‡å¼(11)çš„m*_iè®¡ç®—
   - **æ–¹æ³•**ï¼šå°†æ¶ˆè´¹è€…æŒ‰Ï„_iåˆ†ä¸ºK=3ç±»ï¼Œæ¯ç±»ç‹¬ç«‹ä¼˜åŒ–è¡¥å¿
   
2. **Phase 2ï¼ˆæ‰©å±•ï¼‰**ï¼šæ¢ç´¢æ–¹æ¡ˆAï¼ˆè¿ç»­ä¼˜åŒ–ï¼‰
   - **ç†ç”±**ï¼šå®Œå…¨å¯¹é½è®ºæ–‡ï¼Œå®ç°é€ä¸ªæ¶ˆè´¹è€…çš„m*_i
   - **æŒ‘æˆ˜**ï¼šä¼˜åŒ–ç»´åº¦é«˜ï¼ˆN=100æ—¶ä¸º100ç»´ï¼‰
   - **æ–¹æ³•**ï¼šä½¿ç”¨SGDæˆ–è¿›åŒ–ç®—æ³•
   
3. **Phase 3ï¼ˆå¯¹æ¯”ï¼‰**ï¼šä¿ç•™ç»Ÿä¸€mä½œä¸ºç®€åŒ–åŸºå‡†
   - **ç†ç”±**ï¼šç”¨äºå¯¹æ¯”å’Œæ•™å­¦
   - **æ ‡æ³¨**ï¼šæ˜ç¡®è¯´æ˜è¿™æ˜¯ç®€åŒ–ç‰ˆæœ¬ï¼Œåç¦»è®ºæ–‡

**ä¼˜å…ˆçº§åˆ¤æ–­ï¼ˆä¿®æ­£ï¼‰**ï¼š
- âŒ **é”™è¯¯ç†è§£**ï¼š~~"è®ºæ–‡ç®€åŒ–é‡‡ç”¨ç»Ÿä¸€m"~~  
- âœ… **æ­£ç¡®ç†è§£**ï¼šè®ºæ–‡æ ‡å‡†è®¾å®šæ˜¯m_iï¼Œæˆ‘ä»¬çš„ç»Ÿä¸€mæ˜¯ç®€åŒ–
- ğŸ”´ **å¿…éœ€ä¿®æ”¹**ï¼šå®ç°æ–¹æ¡ˆBï¼ˆç¦»æ•£m_iï¼‰ä»¥å¯¹é½è®ºæ–‡
- ğŸ”µ **å¯é€‰æ‰©å±•**ï¼šå®ç°æ–¹æ¡ˆAï¼ˆè¿ç»­m_iï¼‰ä»¥å®Œå…¨å¯¹é½

---

## ä¸‰ã€ä¿®æ”¹2ï¼šä¸­ä»‹åˆ©æ¶¦çº¦æŸï¼ˆR > 0ï¼‰

### 3.1 ç†è®ºä¾æ®

**ç†æ€§å‚ä¸çº¦æŸ** (Implicit in Section 4):

ä¸­ä»‹å‚ä¸å¸‚åœºçš„å¿…è¦æ¡ä»¶ï¼š
```
R = m_0 - Î£_i m_i Â· a_i â‰¥ 0
```

å¦åˆ™ä¸­ä»‹åº”é€‰æ‹©**ä¸å‚ä¸å¸‚åœº**ï¼ˆä¸è´­ä¹°æ•°æ®ï¼‰ã€‚

**è®ºæ–‡éšå«å‡è®¾**ï¼š
- Proposition 4-5è®¨è®º"Profitable Intermediation"æ—¶ï¼Œéšå«å‡è®¾R > 0
- å¦‚æœæ•°æ®é™ä½ç”Ÿäº§è€…åˆ©æ¶¦ï¼ˆm_0 < 0ï¼‰ï¼Œä¸­ä»‹ä¸ä¼šè´­ä¹°æ•°æ®

### 3.2 å½“å‰å®ç°ï¼ˆéƒ¨åˆ†æ”¯æŒï¼‰

```python
# src/scenarios/scenario_c_social_data.py, Line ~2783
def estimate_m0_mc(...):
    """ä¼°è®¡ä¸­ä»‹å‘ç”Ÿäº§è€…æ”¶å–çš„è´¹ç”¨m_0"""
    # è®¡ç®—ç”Ÿäº§è€…åˆ©æ¶¦å¢ç›Š
    delta_mean = np.mean(deltas)
    
    # âœ… å·²å®ç°ï¼šç¡®ä¿m_0éè´Ÿ
    m_0 = beta * max(0.0, delta_mean)
    
    return m_0, delta_mean, delta_std, e_num_participants
```

```python
# src/scenarios/scenario_c_social_data.py, Line ~2934
def evaluate_intermediary_strategy(...):
    """è¯„ä¼°ä¸­ä»‹ç­–ç•¥"""
    # è®¡ç®—ä¸­ä»‹åˆ©æ¶¦
    intermediary_cost = m * e_num_participants
    intermediary_profit = m_0 - intermediary_cost
    
    # âŒ æœªå®ç°ï¼šæ²¡æœ‰è¿‡æ»¤æ‰R < 0çš„ç­–ç•¥
    return IntermediaryOptimizationResult(
        intermediary_profit=intermediary_profit,  # å¯èƒ½ä¸ºè´Ÿ
        ...
    )
```

```python
# src/scenarios/scenario_c_social_data.py, Line ~2995
def optimize_intermediary_policy(...):
    """ç½‘æ ¼æœç´¢æœ€ä¼˜ç­–ç•¥"""
    all_results = []
    
    for m in m_grid:
        for anon in policies:
            result = evaluate_intermediary_strategy(m, anon, ...)
            all_results.append(result)
    
    # âŒ æœªå®ç°ï¼šæ²¡æœ‰è¿‡æ»¤æ‰äºæŸç­–ç•¥
    optimal_result = max(all_results, key=lambda x: x.intermediary_profit)
    
    return optimal_result  # å¯èƒ½ä»ä¸ºè´Ÿåˆ©æ¶¦
```

**é—®é¢˜**ï¼š
1. âŒ å…è®¸ä¸­ä»‹é€‰æ‹©äºæŸç­–ç•¥ï¼ˆR < 0ï¼‰
2. âŒ æ²¡æœ‰"ä¸å‚ä¸å¸‚åœº"çš„é€€å‡ºé€‰é¡¹
3. âŒ ä¸ç†æ€§å‚ä¸çº¦æŸä¸ä¸€è‡´

### 3.3 ä¿®æ”¹æ–¹æ¡ˆï¼ˆå¼ºåˆ¶R > 0ï¼‰

```python
# ä¿®æ”¹ï¼šè¿‡æ»¤äºæŸç­–ç•¥
def optimize_intermediary_policy(
    params_base: Dict,
    m_grid: np.ndarray = None,
    policies: List[str] = None,
    num_mc_samples: int = 50,
    max_iter: int = 20,
    tol: float = 1e-3,
    seed: Optional[int] = None,
    verbose: bool = True
) -> OptimalPolicy:
    """
    æ±‚è§£ä¸­ä»‹æœ€ä¼˜ç­–ç•¥ï¼Œå¼ºåˆ¶åˆ©æ¶¦çº¦æŸ
    
    **æ–°å¢**: åªè€ƒè™‘R > 0çš„ç­–ç•¥ï¼Œå¦åˆ™é€‰æ‹©ä¸å‚ä¸
    """
    if seed is not None:
        np.random.seed(seed)
    
    if m_grid is None:
        m_grid = np.linspace(0, 3.0, 31)
    
    if policies is None:
        policies = ['identified', 'anonymized']
    
    if verbose:
        print("\n" + "="*80)
        print("ğŸ¯ ä¸­ä»‹æœ€ä¼˜ç­–ç•¥æ±‚è§£ï¼ˆå¼ºåˆ¶åˆ©æ¶¦çº¦æŸ R > 0ï¼‰")
        print("="*80)
    
    all_results = []
    
    # éå†æ‰€æœ‰å€™é€‰ç­–ç•¥
    for m in m_grid:
        for anonymization in policies:
            if verbose:
                print(f"\nè¯„ä¼°ç­–ç•¥: m={m:.4f}, {anonymization}")
            
            result = evaluate_intermediary_strategy(
                m=m,
                anonymization=anonymization,
                params_base=params_base,
                num_mc_samples=num_mc_samples,
                max_iter=max_iter,
                tol=tol,
                seed=seed
            )
            
            # âœ… æ–°å¢ï¼šè®°å½•æ‰€æœ‰ç»“æœï¼ˆåŒ…æ‹¬äºæŸï¼‰
            all_results.append(result)
            
            if verbose:
                print(f"  r* = {result.r_star:.4f}")
                print(f"  R = {result.intermediary_profit:.4f}")
    
    # ============================================================
    # âœ… æ ¸å¿ƒä¿®æ”¹ï¼šè¿‡æ»¤æ‰äºæŸç­–ç•¥
    # ============================================================
    profitable_results = [
        r for r in all_results 
        if r.intermediary_profit > 0.0  # ä¸¥æ ¼æ­£åˆ©æ¶¦
    ]
    
    if not profitable_results:
        # æ‰€æœ‰ç­–ç•¥éƒ½äºæŸ â†’ ä¸­ä»‹é€‰æ‹©ä¸å‚ä¸å¸‚åœº
        if verbose:
            print("\n" + "="*80)
            print("âš ï¸  æ‰€æœ‰ç­–ç•¥å‡äºæŸï¼Œä¸­ä»‹é€‰æ‹©ä¸å‚ä¸å¸‚åœº")
            print("="*80)
            max_loss = max(r.intermediary_profit for r in all_results)
            print(f"æœ€å°äºæŸ: R = {max_loss:.4f}")
        
        # è¿”å›"ä¸å‚ä¸"ç­–ç•¥
        return OptimalPolicy(
            m_star=0.0,
            anonymization_star="no_participation",
            r_star=0.0,
            delta_u_star=0.0,
            intermediary_profit=0.0,  # ä¸å‚ä¸ â†’ é›¶åˆ©æ¶¦
            social_welfare=0.0,
            participation_feasible=False,
            all_results=all_results
        )
    
    # âœ… ä»ç›ˆåˆ©ç­–ç•¥ä¸­é€‰æ‹©æœ€ä¼˜
    optimal_result = max(
        profitable_results, 
        key=lambda x: x.intermediary_profit
    )
    
    if verbose:
        print("\n" + "="*80)
        print("âœ… æœ€ä¼˜ç­–ç•¥ï¼ˆç›ˆåˆ©çº¦æŸä¸‹ï¼‰")
        print("="*80)
        print(f"m* = {optimal_result.m:.4f}")
        print(f"anonymization* = {optimal_result.anonymization}")
        print(f"r* = {optimal_result.r_star:.4f}")
        print(f"R* = {optimal_result.intermediary_profit:.4f} > 0 âœ“")
        print(f"è¢«æ·˜æ±°çš„ç­–ç•¥æ•°: {len(all_results) - len(profitable_results)}")
    
    return OptimalPolicy(
        m_star=optimal_result.m,
        anonymization_star=optimal_result.anonymization,
        r_star=optimal_result.r_star,
        delta_u_star=optimal_result.delta_u,
        intermediary_profit=optimal_result.intermediary_profit,
        consumer_surplus=optimal_result.consumer_surplus,
        producer_profit=optimal_result.producer_profit_with_data,
        social_welfare=optimal_result.social_welfare,
        gini_coefficient=optimal_result.gini_coefficient,
        price_discrimination_index=optimal_result.price_discrimination_index,
        participation_feasible=True,
        all_results=all_results,
        profitable_results=profitable_results  # âœ… æ–°å¢å­—æ®µ
    )
```

```python
# ä¿®æ”¹ï¼šæ•°æ®ç»“æ„æ”¯æŒ"ä¸å‚ä¸"çŠ¶æ€
@dataclass
class OptimalPolicy:
    """æœ€ä¼˜ç­–ç•¥ç»“æœ"""
    m_star: float
    anonymization_star: str  # å¯èƒ½ä¸º "no_participation"
    r_star: float
    delta_u_star: float
    intermediary_profit: float
    consumer_surplus: float
    producer_profit: float
    social_welfare: float
    gini_coefficient: float
    price_discrimination_index: float
    participation_feasible: bool  # âœ… æ–°å¢ï¼šæ ‡è®°å¸‚åœºæ˜¯å¦å¯è¡Œ
    all_results: List[IntermediaryOptimizationResult]
    profitable_results: List[IntermediaryOptimizationResult] = None  # âœ… æ–°å¢
```

### 3.4 å¯¹æ¯”æ€»ç»“

| ç»´åº¦        | åŸå®ç°             | ä¿®æ”¹å        |
| --------- | --------------- | ---------- |
| **m_0çº¦æŸ** | âœ… max(0, delta) | âœ… ä¿æŒä¸å˜     |
| **Rçº¦æŸ**   | âŒ æ— çº¦æŸ           | âœ… å¼ºåˆ¶ R > 0 |
| **ä¸å‚ä¸é€‰é¡¹** | âŒ ä¸å­˜åœ¨           | âœ… Râ‰¤0æ—¶è§¦å‘   |
| **ç»æµåˆç†æ€§** | âš ï¸ ä¸­ä»‹å¯èƒ½äºæŸå‚ä¸     | âœ… ç¬¦åˆç†æ€§å‚ä¸çº¦æŸ |
| **è®ºæ–‡å¯¹é½**  | âš ï¸ éšå«å‡è®¾æœªæ˜¾å¼      | âœ… æ˜¾å¼å®ç°å‡è®¾   |

### 3.5 ç¤ºä¾‹è¾“å‡º

```
ğŸ¯ ä¸­ä»‹æœ€ä¼˜ç­–ç•¥æ±‚è§£ï¼ˆå¼ºåˆ¶åˆ©æ¶¦çº¦æŸ R > 0ï¼‰
================================================================================

è¯„ä¼°ç­–ç•¥: m=0.0000, identified
  r* = 1.0000
  R = -0.5000  â† äºæŸ

è¯„ä¼°ç­–ç•¥: m=0.0000, anonymized
  r* = 1.0000
  R = -0.3000  â† äºæŸ

è¯„ä¼°ç­–ç•¥: m=0.5000, anonymized
  r* = 0.8500
  R = 0.2000  â† ç›ˆåˆ© âœ“

...

================================================================================
âœ… æœ€ä¼˜ç­–ç•¥ï¼ˆç›ˆåˆ©çº¦æŸä¸‹ï¼‰
================================================================================
m* = 0.5000
anonymization* = anonymized
r* = 0.8500
R* = 0.2000 > 0 âœ“
è¢«æ·˜æ±°çš„ç­–ç•¥æ•°: 12 / 62
```

---

## å››ã€ä¿®æ”¹3ï¼šè¿­ä»£å†å²ä¿¡æ¯ä¼˜åŒ–ï¼ˆå…³é”®è¯æå–ï¼‰

### 4.1 å·¥ç¨‹é—®é¢˜èƒŒæ™¯

**å½“å‰å®ç°** (`evaluate_scenario_c.py`, Line ~2820):

```python
# ä¸­ä»‹LLMæç¤ºè¯ï¼ˆé…ç½®D_FPï¼‰
feedback_text = f"""
ã€ä¸Šè½®åé¦ˆã€‘
- m = {feedback.get('m')}, anonymization = {feedback.get('anonymization')}
- å‚ä¸ç‡ r = {feedback.get('participation_rate'):.4f}
- ä¸­ä»‹åˆ©æ¶¦ = {feedback.get('intermediary_profit'):.4f}
- å‚ä¸è€…ç†ç”±ï¼ˆé€æ¡ï¼‰: {reasons.get('participants')}  â† é—®é¢˜ï¼
- æ‹’ç»è€…ç†ç”±ï¼ˆé€æ¡ï¼‰: {reasons.get('rejecters')}    â† é—®é¢˜ï¼
"""
```

**é—®é¢˜åœºæ™¯**ï¼š
- N = 100æ—¶ï¼Œ`reasons['participants']`å¯èƒ½åŒ…å«80+æ¡æ–‡æœ¬
- æ¯æ¡ç†ç”±50-100å­— â†’ æ€»é•¿åº¦4000-8000å­—
- å¤šè½®è¿­ä»£åï¼Œæç¤ºè¯é•¿åº¦çˆ†ç‚¸ â†’ Tokenæµªè´¹ã€å“åº”å˜æ…¢

**è®ºæ–‡éšå«æ”¯æŒ** (Section 4.2, Large Markets):
> "Perhaps, the defining feature of data markets is the multitude of (potential) participants, data sources, and services."

è®ºæ–‡è®¨è®ºå¤§å¸‚åœº(Nâ†’âˆ)æ—¶ï¼Œå¼ºè°ƒéœ€è¦èšåˆä¿¡æ¯è€Œéå¤„ç†æ¯ä¸ªä¸ªä½“ç»†èŠ‚ã€‚

### 4.2 å½“å‰å®ç°ï¼ˆå®Œæ•´ç†ç”±ä¼ é€’ï¼‰

```python
# evaluate_scenario_c.py, Line ~1154
def evaluate_config_D_iterative(...):
    """é…ç½®Dï¼šLLMä¸­ä»‹ Ã— LLMæ¶ˆè´¹è€…ï¼ˆå¤šè½®è¿­ä»£ï¼‰"""
    
    for t in range(1, num_rounds + 1):
        # 1. æ”¶é›†æ¶ˆè´¹è€…ç†ç”±
        reasons_participants = []
        reasons_rejecters = []
        
        for consumer_params in consumers:
            decision, reason = llm_consumer_agent.decide_with_reason(
                consumer_params, m_llm, anon_llm
            )
            
            if decision:
                reasons_participants.append(f"å‚ä¸ï¼š{reason}")
            else:
                reasons_rejecters.append(f"æ‹’ç»ï¼š{reason}")
        
        # 2. âŒ é—®é¢˜ï¼šç›´æ¥ä¼ é€’æ‰€æœ‰ç†ç”±
        feedback = {
            'participation_rate': r_llm,
            'intermediary_profit': profit,
            'reasons': {
                'participants': reasons_participants,  # é•¿åº¦ = NÂ·r
                'rejecters': reasons_rejecters          # é•¿åº¦ = NÂ·(1-r)
            }
        }
        
        # 3. ä¸­ä»‹LLMå¤„ç†ï¼ˆæç¤ºè¯è¿‡é•¿ï¼‰
        m_llm, anon_llm, reason, raw = llm_intermediary_agent(
            market_params=market_params,
            feedback=feedback,  # åŒ…å«æ‰€æœ‰åŸå§‹ç†ç”±
            history=history
        )
```

**å®é™…æç¤ºè¯ç¤ºä¾‹**ï¼ˆN=20, r=0.6ï¼‰:

```
ã€ä¸Šè½®åé¦ˆã€‘
- å‚ä¸è€…ç†ç”±ï¼ˆé€æ¡ï¼‰:
  * å‚ä¸ï¼šè¡¥å¿0.8è¶³ä»¥è¦†ç›–æˆ‘çš„éšç§æˆæœ¬0.5ï¼Œä¸”åŒ¿ååŒ–ä¿æŠ¤äº†æˆ‘çš„èº«ä»½
  * å‚ä¸ï¼šæœŸæœ›æ”¶ç›Šå¤§äºéšç§é¡¾è™‘ï¼Œæ„¿æ„åˆ†äº«æ•°æ®
  * å‚ä¸ï¼šåŒ¿ååŒ–æ”¿ç­–é™ä½äº†é£é™©ï¼Œè¡¥å¿ä¹Ÿè¾ƒåˆç†
  * å‚ä¸ï¼š... (è¿˜æœ‰9æ¡)
  
- æ‹’ç»è€…ç†ç”±ï¼ˆé€æ¡ï¼‰:
  * æ‹’ç»ï¼šéšç§æˆæœ¬1.2é«˜äºè¡¥å¿0.8ï¼Œä¸å‚ä¸
  * æ‹’ç»ï¼šæ‹…å¿ƒæ•°æ®è¢«æ»¥ç”¨ï¼Œå³ä½¿åŒ¿åä¹Ÿä¸ä¿¡ä»»
  * æ‹’ç»ï¼šè¡¥å¿å¤ªä½ï¼Œæ— æ³•å¼¥è¡¥ä¿¡æ¯æ³„éœ²é£é™©
  * æ‹’ç»ï¼š... (è¿˜æœ‰5æ¡)

â†’ æ€»é•¿åº¦ï¼š12æ¡ Ã— 50å­— â‰ˆ 600å­—ï¼ˆToken ~900ï¼‰
```

å½“N=100æ—¶ï¼Œé•¿åº¦å°†è¾¾åˆ°6000+å­—ï¼Œä¸¥é‡å½±å“æ•ˆç‡ã€‚

### 4.3 ä¿®æ”¹æ–¹æ¡ˆï¼ˆå…³é”®è¯èšåˆï¼‰

#### æ–¹æ¡ˆAï¼šé¢‘ç‡ç»Ÿè®¡ + å…³é”®è¯æå–ï¼ˆæ¨èï¼‰

```python
# æ–°å¢ï¼šå…³é”®è¯æå–æ¨¡å—
PARTICIPATION_KEYWORDS = {
    # å‚ä¸åŠ¨æœº
    'compensation': ['è¡¥å¿', 'æ”¶ç›Š', 'å€¼å¾—', 'åˆ’ç®—', 'è¶³å¤Ÿ', 'åˆç†'],
    'anonymization': ['åŒ¿å', 'ä¿æŠ¤', 'éšç§æ”¿ç­–', 'å®‰å…¨'],
    'trust': ['ä¿¡ä»»', 'å¯é ', 'å¹³å°'],
    'social_benefit': ['ç¤¾ä¼š', 'è´¡çŒ®', 'å¸®åŠ©'],
    'low_cost': ['æˆæœ¬ä½', 'å½±å“å°', 'æ— æ‰€è°“'],
    
    # æ‹’ç»åŸå› 
    'high_cost': ['éšç§æˆæœ¬', 'å¤ªé«˜', 'æŸå¤±å¤§', 'é£é™©é«˜'],
    'insufficient_comp': ['è¡¥å¿ä¸è¶³', 'å¤ªä½', 'ä¸å¤Ÿ'],
    'distrust': ['ä¸ä¿¡ä»»', 'æ‹…å¿ƒ', 'é¡¾è™‘', 'æ€€ç–‘'],
    'no_anonymization': ['èº«ä»½æš´éœ²', 'å¯è¯†åˆ«', 'ä¸åŒ¿å'],
    'principle': ['åŸåˆ™', 'ä¸å–', 'åšå†³æ‹’ç»']
}

def extract_keywords_from_reasons(
    reasons: List[str],
    keyword_dict: Dict[str, List[str]]
) -> Dict[str, int]:
    """
    ä»ç†ç”±åˆ—è¡¨ä¸­æå–å…³é”®è¯é¢‘ç‡
    
    Args:
        reasons: ç†ç”±æ–‡æœ¬åˆ—è¡¨
        keyword_dict: å…³é”®è¯åˆ†ç±»å­—å…¸
    
    Returns:
        {category: count} å­—å…¸
    """
    keyword_counts = {category: 0 for category in keyword_dict}
    
    for reason in reasons:
        for category, keywords in keyword_dict.items():
            for keyword in keywords:
                if keyword in reason:
                    keyword_counts[category] += 1
                    break  # æ¯æ¡ç†ç”±æ¯ä¸ªç±»åˆ«åªè®¡æ•°ä¸€æ¬¡
    
    return keyword_counts


def summarize_reasons(
    reasons_participants: List[str],
    reasons_rejecters: List[str],
    sample_size: int = 5
) -> Dict:
    """
    èšåˆç†ç”±ï¼šå…³é”®è¯é¢‘ç‡ + ä»£è¡¨æ€§æ ·æœ¬
    
    è¿”å›ç»“æ„ï¼š
    {
        'participants': {
            'count': int,
            'keywords': {category: count},
            'samples': [str, ...]  # ä»£è¡¨æ€§æ ·æœ¬
        },
        'rejecters': {
            'count': int,
            'keywords': {category: count},
            'samples': [str, ...]
        }
    }
    """
    # 1. æå–å…³é”®è¯é¢‘ç‡
    part_keywords = extract_keywords_from_reasons(
        reasons_participants, 
        PARTICIPATION_KEYWORDS
    )
    
    rej_keywords = extract_keywords_from_reasons(
        reasons_rejecters,
        PARTICIPATION_KEYWORDS
    )
    
    # 2. é‡‡æ ·ä»£è¡¨æ€§ç†ç”±
    # ç­–ç•¥ï¼šéšæœºé‡‡æ · + é•¿åº¦è¿‡æ»¤ï¼ˆé€‰æ‹©è¯¦ç»†ç†ç”±ï¼‰
    part_samples = random.sample(
        reasons_participants,
        min(sample_size, len(reasons_participants))
    ) if reasons_participants else []
    
    rej_samples = random.sample(
        reasons_rejecters,
        min(sample_size, len(reasons_rejecters))
    ) if reasons_rejecters else []
    
    # 3. æŒ‰é•¿åº¦æ’åºï¼ˆä¼˜å…ˆå±•ç¤ºè¯¦ç»†ç†ç”±ï¼‰
    part_samples = sorted(part_samples, key=len, reverse=True)[:sample_size]
    rej_samples = sorted(rej_samples, key=len, reverse=True)[:sample_size]
    
    return {
        'participants': {
            'count': len(reasons_participants),
            'keywords': part_keywords,
            'samples': part_samples
        },
        'rejecters': {
            'count': len(reasons_rejecters),
            'keywords': rej_keywords,
            'samples': rej_samples
        }
    }
```

```python
# ä¿®æ”¹ï¼šåœ¨è¯„ä¼°å™¨ä¸­ä½¿ç”¨èšåˆ
def evaluate_config_D_iterative(...):
    """é…ç½®Dï¼šLLMä¸­ä»‹ Ã— LLMæ¶ˆè´¹è€…ï¼ˆä¼˜åŒ–ç‰ˆï¼‰"""
    
    for t in range(1, num_rounds + 1):
        # 1. æ”¶é›†åŸå§‹ç†ç”±ï¼ˆåŒä¸Šï¼‰
        reasons_participants = []
        reasons_rejecters = []
        # ... æ”¶é›†é€»è¾‘ ...
        
        # 2. âœ… æ–°å¢ï¼šèšåˆç†ç”±
        reason_summary = summarize_reasons(
            reasons_participants,
            reasons_rejecters,
            sample_size=5  # æ¯ç±»åªä¿ç•™5æ¡ä»£è¡¨
        )
        
        # 3. âœ… ä½¿ç”¨èšåˆä¿¡æ¯
        feedback = {
            'participation_rate': r_llm,
            'intermediary_profit': profit,
            'reason_summary': reason_summary  # æ›¿ä»£åŸå§‹ç†ç”±
        }
        
        # 4. ä¸­ä»‹LLMå¤„ç†ï¼ˆæç¤ºè¯ç²¾ç®€ï¼‰
        m_llm, anon_llm, reason, raw = llm_intermediary_agent(
            market_params=market_params,
            feedback=feedback,
            history=history
        )
```

```python
# ä¿®æ”¹ï¼šæç¤ºè¯ç”Ÿæˆï¼ˆç²¾ç®€ç‰ˆï¼‰
def create_llm_intermediary(...):
    def llm_intermediary(market_params, feedback=None, history=None):
        # ... å‰ç½®é€»è¾‘ ...
        
        if feedback and 'reason_summary' in feedback:
            rs = feedback['reason_summary']
            
            # âœ… ç²¾ç®€æ ¼å¼
            feedback_text = f"""
ã€ä¸Šè½®åé¦ˆã€‘
åŸºç¡€ä¿¡æ¯:
- m = {feedback.get('m'):.3f}, anonymization = {feedback.get('anonymization')}
- å‚ä¸ç‡: {feedback.get('participation_rate'):.2%}
- ä¸­ä»‹åˆ©æ¶¦: {feedback.get('intermediary_profit'):.3f}

å‚ä¸è€…åˆ†æ (n={rs['participants']['count']}):
- å…³é”®åŠ¨æœºç»Ÿè®¡:
  * è¡¥å¿åˆç†: {rs['participants']['keywords']['compensation']}äºº
  * åŒ¿åä¿æŠ¤: {rs['participants']['keywords']['anonymization']}äºº
  * ä¿¡ä»»å¹³å°: {rs['participants']['keywords']['trust']}äºº
- å…¸å‹ç†ç”±æ ·æœ¬ (éšæœº5æ¡):
  {chr(10).join(f'  {i+1}. {s[:80]}...' for i, s in enumerate(rs['participants']['samples']))}

æ‹’ç»è€…åˆ†æ (n={rs['rejecters']['count']}):
- å…³é”®é¡¾è™‘ç»Ÿè®¡:
  * éšç§æˆæœ¬é«˜: {rs['rejecters']['keywords']['high_cost']}äºº
  * è¡¥å¿ä¸è¶³: {rs['rejecters']['keywords']['insufficient_comp']}äºº
  * ä¸ä¿¡ä»»: {rs['rejecters']['keywords']['distrust']}äºº
- å…¸å‹ç†ç”±æ ·æœ¬ (éšæœº5æ¡):
  {chr(10).join(f'  {i+1}. {s[:80]}...' for i, s in enumerate(rs['rejecters']['samples']))}
"""
        
        prompt = f"""ä½ æ˜¯æ•°æ®ä¸­ä»‹ï¼Œç›®æ ‡æ˜¯æœ€å¤§åŒ–åˆ©æ¶¦ã€‚

ã€å¸‚åœºå‚æ•°ã€‘
... (ä¿æŒä¸å˜) ...

{feedback_text}

ã€ç­–ç•¥è°ƒæ•´ã€‘
æ ¹æ®ä¸Šè¿°åé¦ˆï¼Œè°ƒæ•´ä½ çš„ç­–ç•¥ä»¥æé«˜åˆ©æ¶¦...
"""
        # ... åç»­é€»è¾‘ ...
```

**æç¤ºè¯å¯¹æ¯”** (N=100, r=0.6):

| ç‰ˆæœ¬ | ç†ç”±æ•° | Tokenæ•° | ä¿¡æ¯æŸå¤± |
|------|--------|---------|----------|
| **åŸç‰ˆ** | 60å‚ä¸ + 40æ‹’ç» | ~6000 tokens | 0% |
| **æ–¹æ¡ˆA** | 5æ ·æœ¬ + å…³é”®è¯ç»Ÿè®¡ | ~500 tokens | <10% |
| **å‹ç¼©ç‡** | - | **92%å‡å°‘** | - |

#### æ–¹æ¡ˆBï¼šLLMè‡ªåŠ¨æ‘˜è¦ï¼ˆå¯é€‰ï¼Œæˆæœ¬é«˜ï¼‰

```python
def summarize_reasons_with_llm(
    reasons: List[str],
    client,
    model: str = "gpt-4o-mini"
) -> str:
    """
    ä½¿ç”¨LLMæ€»ç»“ç†ç”±ï¼ˆé¢å¤–APIè°ƒç”¨ï¼‰
    """
    reasons_text = '\n'.join(f'{i+1}. {r}' for i, r in enumerate(reasons))
    
    prompt = f"""è¯·æ€»ç»“ä»¥ä¸‹{len(reasons)}æ¡å†³ç­–ç†ç”±çš„æ ¸å¿ƒè¦ç‚¹ï¼ˆ3-5ä¸ªå…³é”®è¯æˆ–çŸ­è¯­ï¼‰ï¼š

{reasons_text}

è¾“å‡ºæ ¼å¼ï¼š
- å…³é”®è¯1: é¢‘æ¬¡/å æ¯”
- å…³é”®è¯2: é¢‘æ¬¡/å æ¯”
...
"""
    
    response = client.chat.completions.create(
        model=model,
        messages=[{"role": "user", "content": prompt}],
        temperature=0.0
    )
    
    return response.choices[0].message.content.strip()
```

**æˆæœ¬åˆ†æ**ï¼š
- ä¼˜ç‚¹ï¼šæ›´æ™ºèƒ½çš„è¯­ä¹‰èšåˆ
- ç¼ºç‚¹ï¼šæ¯è½®é¢å¤–1æ¬¡APIè°ƒç”¨ï¼Œå¢åŠ å»¶è¿Ÿå’Œæˆæœ¬
- å»ºè®®ï¼šä»…åœ¨å…³é”®è¯æ–¹æ¡ˆæ•ˆæœä¸ä½³æ—¶ä½¿ç”¨

#### æ–¹æ¡ˆCï¼šå†å²çª—å£æˆªæ–­ï¼ˆæœ€ç®€å•ï¼‰

```python
def truncate_history(history: List[Dict], window_size: int = 5) -> List[Dict]:
    """åªä¿ç•™æœ€è¿‘Nè½®å†å²"""
    return history[-window_size:] if len(history) > window_size else history

# ä½¿ç”¨
history_truncated = truncate_history(history, window_size=5)
```

**é€‚ç”¨åœºæ™¯**ï¼š
- å¿«é€Ÿä¿®å¤ï¼Œæœ€å°æ”¹åŠ¨
- ä½†ä¿¡æ¯æŸå¤±è¾ƒå¤§ï¼ˆä¸¢å¼ƒæ—©æœŸé«˜ä»·å€¼è®°å¿†ï¼‰

### 4.4 æ¨èå®æ–½è·¯å¾„

```python
# ç»¼åˆæ–¹æ¡ˆï¼šæ–¹æ¡ˆAï¼ˆå…³é”®è¯ï¼‰ + æ–¹æ¡ˆCï¼ˆçª—å£ï¼‰
def create_optimized_feedback(
    reasons_participants: List[str],
    reasons_rejecters: List[str],
    history: List[Dict],
    sample_size: int = 5,
    history_window: int = 5
) -> Tuple[Dict, List[Dict]]:
    """
    ä¼˜åŒ–åçš„åé¦ˆç”Ÿæˆ
    
    Returns:
        (feedback, truncated_history)
    """
    # 1. èšåˆå½“å‰è½®ç†ç”±
    reason_summary = summarize_reasons(
        reasons_participants,
        reasons_rejecters,
        sample_size=sample_size
    )
    
    # 2. æˆªæ–­å†å²
    truncated_history = history[-history_window:] if history else []
    
    # 3. æ„å»ºåé¦ˆ
    feedback = {
        'reason_summary': reason_summary,
        # ... å…¶ä»–æŒ‡æ ‡ ...
    }
    
    return feedback, truncated_history
```

### 4.5 å¯¹æ¯”æ€»ç»“

| æ–¹æ¡ˆ | Tokenå‡å°‘ | ä¿¡æ¯ä¿ç•™ | å®ç°å¤æ‚åº¦ | æ¨èåº¦ |
|------|-----------|----------|------------|--------|
| **æ–¹æ¡ˆA: å…³é”®è¯+æ ·æœ¬** | 90-95% | 85-90% | ä¸­ç­‰ | â­â­â­â­â­ |
| **æ–¹æ¡ˆB: LLMæ‘˜è¦** | 95%+ | 90%+ | é«˜ï¼ˆé¢å¤–APIï¼‰ | â­â­â­ |
| **æ–¹æ¡ˆC: çª—å£æˆªæ–­** | 80%ï¼ˆå†å²ï¼‰ | 60-70% | ä½ | â­â­â­ |
| **ç»¼åˆ: A+C** | 95%+ | 80-85% | ä¸­ç­‰ | â­â­â­â­â­ |

---

## äº”ã€å®æ–½ä¼˜å…ˆçº§ä¸æ—¶é—´è¡¨ï¼ˆâ—å·²ä¿®æ­£ï¼‰

### 5.1 ä¼˜å…ˆçº§æ’åºï¼ˆä¿®æ­£ç‰ˆï¼‰

| ä¿®æ”¹ | ä¼˜å…ˆçº§ | ç†ç”± | é¢„è®¡å·¥ä½œé‡ |
|------|--------|------|------------|
| **ä¿®æ”¹2: åˆ©æ¶¦çº¦æŸ** | ğŸ”´ P0 (ç«‹å³) | ä¿®å¤ç†è®ºç¼ºé™·ï¼Œå½±å“æ‰€æœ‰å®éªŒ | 0.5å¤© |
| **ä¿®æ”¹1: mä¸ªæ€§åŒ–ï¼ˆæ–¹æ¡ˆBï¼‰** | ğŸ”´ P0 (ç«‹å³) | âš ï¸ **ä¿®æ­£ç†è®ºåç¦»ï¼Œå¯¹é½è®ºæ–‡æ ‡å‡†è®¾å®š** | 2å¤© |
| **ä¿®æ”¹3: ç†ç”±ä¼˜åŒ–** | ğŸŸ  P1 (æœ¬å‘¨) | è§£å†³å·¥ç¨‹ç“¶é¢ˆï¼Œæå‡å®éªŒæ•ˆç‡ | 1å¤© |
| **ä¿®æ”¹1: mä¸ªæ€§åŒ–ï¼ˆæ–¹æ¡ˆAï¼‰** | ğŸŸ¡ P2 (å¯é€‰) | å®Œå…¨å¯¹é½è®ºæ–‡ï¼Œä½†ä¼˜åŒ–å¤æ‚ | 3-4å¤© |

âš ï¸ **ä¼˜å…ˆçº§è°ƒæ•´è¯´æ˜**ï¼šä¿®æ”¹1ä»P2æå‡è‡³P0ï¼Œå› ä¸ºå‘ç°è®ºæ–‡æ ‡å‡†æ¨¡å‹å°±æ˜¯ä¸ªæ€§åŒ–è¡¥å¿m_iï¼Œè€Œéç»Ÿä¸€è¡¥å¿mã€‚

### 5.2 å®æ–½è®¡åˆ’ï¼ˆä¿®æ­£ç‰ˆï¼‰

#### Week 1: æ ¸å¿ƒä¿®å¤ï¼ˆP0ä¼˜å…ˆçº§ï¼‰

**Day 1**: ä¿®æ”¹2ï¼ˆåˆ©æ¶¦çº¦æŸï¼‰
- [ ] ä¿®æ”¹`optimize_intermediary_policy`æ·»åŠ è¿‡æ»¤é€»è¾‘
- [ ] æ·»åŠ `participation_feasible`å­—æ®µ
- [ ] æ›´æ–°å•å…ƒæµ‹è¯•
- [ ] éªŒè¯ç°æœ‰å®éªŒç»“æœæ˜¯å¦å—å½±å“

**Day 2-3**: ä¿®æ”¹1ï¼ˆmä¸ªæ€§åŒ–ï¼Œæ–¹æ¡ˆB - å¯¹é½è®ºæ–‡ï¼‰
- [ ] å®ç°ç¦»æ•£ç±»å‹è¡¥å¿ï¼ˆK=3ç±»ï¼‰
- [ ] ä¿®æ”¹`ScenarioCParams`æ”¯æŒå‘é‡m
- [ ] å®ç°`compute_optimal_compensation_individual`ï¼ˆè®ºæ–‡å¼11ï¼‰
- [ ] éªŒè¯Proposition 5çš„æ”¶æ•›æ€§è´¨

**Day 4-5**: ä¿®æ”¹3ï¼ˆç†ç”±ä¼˜åŒ–ï¼‰
- [ ] å®ç°`extract_keywords_from_reasons`
- [ ] å®ç°`summarize_reasons`
- [ ] ä¿®æ”¹`evaluate_config_D_iterative`
- [ ] A/Bæµ‹è¯•ï¼šå¯¹æ¯”ä¼˜åŒ–å‰åçš„ä¸­ä»‹å­¦ä¹ æ•ˆæœ

#### Week 2: éªŒè¯ä¸å¯¹æ¯”

**Day 6-7**: å®éªŒéªŒè¯
- [ ] å¯¹æ¯”å®éªŒï¼šç»Ÿä¸€m vs ç¦»æ•£m_iï¼ˆK=3ï¼‰
- [ ] éªŒè¯ä¸­ä»‹åˆ©æ¶¦æ˜¯å¦æå‡ï¼ˆç†è®ºé¢„æœŸï¼šæå‡10-30%ï¼‰
- [ ] æ£€æŸ¥Proposition 5çš„NÂ·m*_iæ˜¯å¦æ”¶æ•›
- [ ] æ’°å†™å¯¹æ¯”åˆ†ææŠ¥å‘Š

**Day 8-10**: æ‰©å±•ï¼ˆå¯é€‰ï¼Œæ–¹æ¡ˆAï¼‰
- [ ] å®ç°å®Œå…¨ä¸ªæ€§åŒ–m_iï¼ˆNç»´ä¼˜åŒ–ï¼‰
- [ ] ä½¿ç”¨è¿›åŒ–ç®—æ³•æˆ–SGD
- [ ] å¯¹æ¯”ï¼šç»Ÿä¸€m vs Kç±»m vs Nç»´m

### 5.3 éªŒæ”¶æ ‡å‡†ï¼ˆä¿®æ­£ç‰ˆï¼‰

**ä¿®æ”¹2ï¼ˆåˆ©æ¶¦çº¦æŸï¼‰**:
- âœ… æ‰€æœ‰äºæŸç­–ç•¥è¢«æ­£ç¡®è¿‡æ»¤
- âœ… è¾“å‡ºåŒ…å«`profitable_results`å­—æ®µ
- âœ… å½“æ— ç›ˆåˆ©ç­–ç•¥æ—¶è¿”å›"ä¸å‚ä¸"
- âœ… ç°æœ‰å•å…ƒæµ‹è¯•é€šè¿‡

**ä¿®æ”¹1ï¼ˆmä¸ªæ€§åŒ–ï¼Œæ–¹æ¡ˆBï¼‰** - âš ï¸ **ç†è®ºå¯¹é½éªŒæ”¶**:
- âœ… å®ç°è®ºæ–‡å¼(11): m*_i = Ui((Si, Xâˆ’i), Xâˆ’i) âˆ’ Ui((Si, X), X)
- âœ… ç¦»æ•£ç±»å‹ä¼˜åŒ–æ”¶æ•›ï¼ˆK=3ç±»ï¼‰
- âœ… éªŒè¯Î£m_i â‰¤ å¸¸æ•°ï¼ˆå¯¹é½Proposition 5.2ï¼‰
- âœ… ä¸­ä»‹åˆ©æ¶¦æå‡ï¼ˆé¢„æœŸ10-30%ç›¸æ¯”ç»Ÿä¸€mï¼‰
- âœ… ä¸è®ºæ–‡ç†è®ºé¢„æµ‹ä¸€è‡´ï¼ˆé«˜Ï„_iè€…è·å¾—é«˜è¡¥å¿ï¼‰

**ä¿®æ”¹3ï¼ˆç†ç”±ä¼˜åŒ–ï¼‰**:
- âœ… Tokenä½¿ç”¨å‡å°‘90%+
- âœ… ä¸­ä»‹å­¦ä¹ æ•ˆæœæ— æ˜¾è‘—ä¸‹é™ï¼ˆåˆ©æ¶¦è¯¯å·®<5%ï¼‰
- âœ… å®éªŒè¿è¡Œæ—¶é—´ç¼©çŸ­30%+
- âœ… å…³é”®è¯è¦†ç›–ç‡>80%

---

## å…­ã€é™„å½•ï¼šå®Œæ•´ä»£ç ç¤ºä¾‹

### A. ä¿®æ”¹2ï¼šåˆ©æ¶¦çº¦æŸï¼ˆå®Œæ•´å®ç°ï¼‰

```python
# src/scenarios/scenario_c_social_data.py

# 1. ä¿®æ”¹æ•°æ®ç±»ï¼šæ”¯æŒä¸å‚ä¸çŠ¶æ€
@dataclass
class OptimalPolicy:
    """æœ€ä¼˜ç­–ç•¥ç»“æœ"""
    m_star: Union[float, np.ndarray]
    anonymization_star: str  # "identified", "anonymized", "no_participation"
    r_star: float
    delta_u_star: float
    intermediary_profit: float
    consumer_surplus: float = 0.0
    producer_profit: float = 0.0
    social_welfare: float = 0.0
    gini_coefficient: float = 0.0
    price_discrimination_index: float = 0.0
    
    # âœ… æ–°å¢å­—æ®µ
    participation_feasible: bool = True  # å¸‚åœºæ˜¯å¦å¯è¡Œ
    profitable_results: List = None      # ç›ˆåˆ©ç­–ç•¥åˆ—è¡¨
    all_results: List = None             # æ‰€æœ‰è¯„ä¼°ç»“æœ


# 2. ä¿®æ”¹ä¼˜åŒ–å‡½æ•°
def optimize_intermediary_policy(
    params_base: Dict,
    m_grid: np.ndarray = None,
    policies: List[str] = None,
    num_mc_samples: int = 50,
    max_iter: int = 20,
    tol: float = 1e-3,
    seed: Optional[int] = None,
    verbose: bool = True,
    require_positive_profit: bool = True  # âœ… æ–°å¢å‚æ•°
) -> OptimalPolicy:
    """
    æ±‚è§£ä¸­ä»‹æœ€ä¼˜ç­–ç•¥ï¼ˆå¼ºåˆ¶åˆ©æ¶¦çº¦æŸï¼‰
    
    Args:
        require_positive_profit: æ˜¯å¦è¦æ±‚R > 0ï¼ˆé»˜è®¤Trueï¼‰
    """
    # ... (åˆå§‹åŒ–ä»£ç åŒå‰) ...
    
    all_results = []
    
    for m in m_grid:
        for anonymization in policies:
            result = evaluate_intermediary_strategy(...)
            all_results.append(result)
    
    # âœ… æ ¸å¿ƒä¿®æ”¹ï¼šè¿‡æ»¤äºæŸç­–ç•¥
    if require_positive_profit:
        profitable_results = [
            r for r in all_results 
            if r.intermediary_profit > 0.0
        ]
        
        if not profitable_results:
            # ä¸å‚ä¸å¸‚åœº
            return OptimalPolicy(
                m_star=0.0,
                anonymization_star="no_participation",
                r_star=0.0,
                delta_u_star=0.0,
                intermediary_profit=0.0,
                participation_feasible=False,
                all_results=all_results
            )
        
        candidates = profitable_results
    else:
        candidates = all_results
        profitable_results = None
    
    # é€‰æ‹©æœ€ä¼˜ç­–ç•¥
    optimal = max(candidates, key=lambda x: x.intermediary_profit)
    
    return OptimalPolicy(
        m_star=optimal.m,
        anonymization_star=optimal.anonymization,
        r_star=optimal.r_star,
        delta_u_star=optimal.delta_u,
        intermediary_profit=optimal.intermediary_profit,
        consumer_surplus=optimal.consumer_surplus,
        producer_profit=optimal.producer_profit_with_data,
        social_welfare=optimal.social_welfare,
        gini_coefficient=optimal.gini_coefficient,
        price_discrimination_index=optimal.price_discrimination_index,
        participation_feasible=True,
        profitable_results=profitable_results,
        all_results=all_results
    )
```

### B. ä¿®æ”¹3ï¼šç†ç”±ä¼˜åŒ–ï¼ˆå®Œæ•´å®ç°ï¼‰

```python
# src/evaluators/evaluate_scenario_c.py

import re
import random
from collections import defaultdict
from typing import Dict, List, Tuple

# ============================================================
# 1. å…³é”®è¯å®šä¹‰
# ============================================================
PARTICIPATION_KEYWORDS = {
    'compensation': ['è¡¥å¿', 'æ”¶ç›Š', 'å€¼å¾—', 'åˆ’ç®—', 'è¶³å¤Ÿ', 'åˆç†', 'å›æŠ¥'],
    'anonymization': ['åŒ¿å', 'ä¿æŠ¤', 'éšç§æ”¿ç­–', 'å®‰å…¨', 'ä¸æš´éœ²'],
    'trust': ['ä¿¡ä»»', 'å¯é ', 'å¹³å°', 'æ‰¿è¯º'],
    'social_benefit': ['ç¤¾ä¼š', 'è´¡çŒ®', 'å¸®åŠ©', 'å…¬ç›Š'],
    'low_cost': ['æˆæœ¬ä½', 'å½±å“å°', 'æ— æ‰€è°“', 'ä¸åœ¨ä¹'],
    
    'high_cost': ['éšç§æˆæœ¬', 'å¤ªé«˜', 'æŸå¤±å¤§', 'é£é™©é«˜', 'ä»£ä»·å¤§'],
    'insufficient_comp': ['è¡¥å¿ä¸è¶³', 'å¤ªä½', 'ä¸å¤Ÿ', 'äºäº†'],
    'distrust': ['ä¸ä¿¡ä»»', 'æ‹…å¿ƒ', 'é¡¾è™‘', 'æ€€ç–‘', 'è¢«éª—'],
    'no_anonymization': ['èº«ä»½æš´éœ²', 'å¯è¯†åˆ«', 'ä¸åŒ¿å', 'å®å'],
    'principle': ['åŸåˆ™', 'ä¸å–', 'åšå†³', 'åº•çº¿']
}


# ============================================================
# 2. å…³é”®è¯æå–
# ============================================================
def extract_keywords_from_reasons(
    reasons: List[str],
    keyword_dict: Dict[str, List[str]] = None
) -> Dict[str, int]:
    """ä»ç†ç”±ä¸­æå–å…³é”®è¯é¢‘ç‡"""
    if keyword_dict is None:
        keyword_dict = PARTICIPATION_KEYWORDS
    
    keyword_counts = {category: 0 for category in keyword_dict}
    
    for reason in reasons:
        reason_lower = reason.lower()
        for category, keywords in keyword_dict.items():
            matched = False
            for keyword in keywords:
                if keyword in reason_lower:
                    keyword_counts[category] += 1
                    matched = True
                    break
            if matched:
                continue  # æ¯æ¡ç†ç”±æ¯ä¸ªç±»åˆ«åªè®¡æ•°ä¸€æ¬¡
    
    return keyword_counts


# ============================================================
# 3. ç†ç”±èšåˆ
# ============================================================
def summarize_reasons(
    reasons_participants: List[str],
    reasons_rejecters: List[str],
    sample_size: int = 5
) -> Dict:
    """
    èšåˆç†ç”±ï¼šå…³é”®è¯ç»Ÿè®¡ + ä»£è¡¨æ€§æ ·æœ¬
    
    Returns:
        {
            'participants': {
                'count': int,
                'keywords': {category: count},
                'samples': [str, ...]
            },
            'rejecters': {...}
        }
    """
    # æå–å…³é”®è¯
    part_keywords = extract_keywords_from_reasons(reasons_participants)
    rej_keywords = extract_keywords_from_reasons(reasons_rejecters)
    
    # é‡‡æ ·ä»£è¡¨æ€§ç†ç”±ï¼ˆæŒ‰é•¿åº¦æ’åºï¼Œé€‰æ‹©è¯¦ç»†çš„ï¼‰
    def sample_representative(reasons: List[str], n: int) -> List[str]:
        if not reasons:
            return []
        # å…ˆæŒ‰é•¿åº¦æ’åº
        sorted_reasons = sorted(reasons, key=len, reverse=True)
        # ä»å‰50%ä¸­éšæœºé‡‡æ ·
        pool_size = max(1, len(sorted_reasons) // 2)
        pool = sorted_reasons[:pool_size]
        sample_n = min(n, len(pool))
        return random.sample(pool, sample_n)
    
    part_samples = sample_representative(reasons_participants, sample_size)
    rej_samples = sample_representative(reasons_rejecters, sample_size)
    
    return {
        'participants': {
            'count': len(reasons_participants),
            'keywords': part_keywords,
            'samples': part_samples
        },
        'rejecters': {
            'count': len(reasons_rejecters),
            'keywords': rej_keywords,
            'samples': rej_samples
        }
    }


# ============================================================
# 4. ä¿®æ”¹è¯„ä¼°å™¨
# ============================================================
class ScenarioCEvaluator:
    # ... å…¶ä»–æ–¹æ³• ...
    
    def evaluate_config_D_iterative(
        self,
        llm_intermediary_agent: Callable,
        llm_consumer_agent: Callable,
        num_rounds: int = 10,
        verbose: bool = True,
        # âœ… æ–°å¢å‚æ•°
        use_reason_aggregation: bool = True,
        sample_size: int = 5
    ) -> Dict:
        """
        é…ç½®Dï¼šLLMä¸­ä»‹ Ã— LLMæ¶ˆè´¹è€…ï¼ˆå¤šè½®è¿­ä»£ï¼Œä¼˜åŒ–ç‰ˆï¼‰
        
        Args:
            use_reason_aggregation: æ˜¯å¦ä½¿ç”¨ç†ç”±èšåˆï¼ˆé»˜è®¤Trueï¼‰
            sample_size: ä¿ç•™çš„ä»£è¡¨æ€§æ ·æœ¬æ•°
        """
        history = []
        
        for t in range(1, num_rounds + 1):
            # 1. æ”¶é›†åŸå§‹ç†ç”±
            reasons_participants = []
            reasons_rejecters = []
            
            for consumer_params in consumers:
                decision, reason = self._call_consumer_agent_with_reason(
                    llm_consumer_agent, consumer_params, m_llm, anon_llm
                )
                
                if decision:
                    reasons_participants.append(reason)
                else:
                    reasons_rejecters.append(reason)
            
            # 2. âœ… èšåˆç†ç”±ï¼ˆæ–°å¢ï¼‰
            if use_reason_aggregation:
                reason_summary = summarize_reasons(
                    reasons_participants,
                    reasons_rejecters,
                    sample_size=sample_size
                )
                
                feedback = {
                    'round': t,
                    'm': m_llm,
                    'anonymization': anon_llm,
                    'participation_rate': r_llm,
                    'intermediary_profit': profit,
                    'reason_summary': reason_summary  # âœ… ä½¿ç”¨èšåˆ
                }
            else:
                # æ—§ç‰ˆï¼šå®Œæ•´ç†ç”±
                feedback = {
                    'round': t,
                    'm': m_llm,
                    'anonymization': anon_llm,
                    'participation_rate': r_llm,
                    'intermediary_profit': profit,
                    'reasons': {
                        'participants': reasons_participants,
                        'rejecters': reasons_rejecters
                    }
                }
            
            # 3. ä¸­ä»‹å†³ç­–
            m_llm, anon_llm, reason, raw = self._call_intermediary_agent(
                llm_intermediary_agent,
                market_params=market_params,
                feedback=feedback,
                history=history[-5:]  # âœ… çª—å£æˆªæ–­
            )
            
            # 4. è®°å½•å†å²
            history.append({
                'round': t,
                'm': m_llm,
                'anonymization': anon_llm,
                'profit': profit,
                # ä¿å­˜èšåˆä¿¡æ¯ï¼ˆè€ŒéåŸå§‹ç†ç”±ï¼‰
                'reason_summary': reason_summary if use_reason_aggregation else None
            })
        
        return {'history': history, ...}


# ============================================================
# 5. ä¿®æ”¹LLMæç¤ºè¯ç”Ÿæˆ
# ============================================================
def create_llm_intermediary_with_aggregation(...):
    def llm_intermediary(market_params, feedback=None, history=None):
        feedback_text = ""
        
        if feedback:
            if 'reason_summary' in feedback:
                # âœ… æ–°ç‰ˆï¼šèšåˆæ ¼å¼
                rs = feedback['reason_summary']
                
                feedback_text = f"""
ã€ä¸Šè½®åé¦ˆã€‘
åŸºç¡€ä¿¡æ¯:
- m = {feedback['m']:.3f}, anonymization = {feedback['anonymization']}
- å‚ä¸ç‡: {feedback['participation_rate']:.1%} ({rs['participants']['count']}/{rs['participants']['count'] + rs['rejecters']['count']})
- ä¸­ä»‹åˆ©æ¶¦: {feedback['intermediary_profit']:.3f}

å‚ä¸è€…åˆ†æ (n={rs['participants']['count']}):
å…³é”®åŠ¨æœºç»Ÿè®¡:
  - è¡¥å¿åˆç†: {rs['participants']['keywords']['compensation']}äººæåŠ
  - åŒ¿åä¿æŠ¤: {rs['participants']['keywords']['anonymization']}äººæåŠ
  - ä¿¡ä»»å¹³å°: {rs['participants']['keywords']['trust']}äººæåŠ
  - ç¤¾ä¼šè´¡çŒ®: {rs['participants']['keywords']['social_benefit']}äººæåŠ
å…¸å‹ç†ç”± (éšæœº{len(rs['participants']['samples'])}æ¡):
"""
                for i, sample in enumerate(rs['participants']['samples'], 1):
                    # æˆªæ–­è¿‡é•¿ç†ç”±
                    sample_short = sample[:100] + '...' if len(sample) > 100 else sample
                    feedback_text += f"  {i}. {sample_short}\n"
                
                feedback_text += f"""
æ‹’ç»è€…åˆ†æ (n={rs['rejecters']['count']}):
å…³é”®é¡¾è™‘ç»Ÿè®¡:
  - éšç§æˆæœ¬é«˜: {rs['rejecters']['keywords']['high_cost']}äººæåŠ
  - è¡¥å¿ä¸è¶³: {rs['rejecters']['keywords']['insufficient_comp']}äººæåŠ
  - ä¸ä¿¡ä»»: {rs['rejecters']['keywords']['distrust']}äººæåŠ
  - æ— åŒ¿å: {rs['rejecters']['keywords']['no_anonymization']}äººæåŠ
å…¸å‹ç†ç”± (éšæœº{len(rs['rejecters']['samples'])}æ¡):
"""
                for i, sample in enumerate(rs['rejecters']['samples'], 1):
                    sample_short = sample[:100] + '...' if len(sample) > 100 else sample
                    feedback_text += f"  {i}. {sample_short}\n"
            
            else:
                # æ—§ç‰ˆï¼šå®Œæ•´ç†ç”±ï¼ˆå…¼å®¹æ€§ï¼‰
                reasons = feedback.get('reasons', {})
                feedback_text = f"""
ã€ä¸Šè½®åé¦ˆã€‘
- m = {feedback['m']}, anonymization = {feedback['anonymization']}
- å‚ä¸ç‡: {feedback['participation_rate']:.1%}
- ä¸­ä»‹åˆ©æ¶¦: {feedback['intermediary_profit']:.3f}
- å‚ä¸è€…ç†ç”±: {reasons.get('participants', [])}
- æ‹’ç»è€…ç†ç”±: {reasons.get('rejecters', [])}
"""
        
        # ... æ„å»ºå®Œæ•´æç¤ºè¯ ...
        prompt = f"""ä½ æ˜¯æ•°æ®ä¸­ä»‹...
{feedback_text}
..."""
        
        # ... è°ƒç”¨LLM ...
    
    return llm_intermediary
```

---

## ä¸ƒã€æ€»ç»“ä¸å»ºè®®ï¼ˆâ—é‡è¦ä¿®æ­£ï¼‰

### å…³é”®è¦ç‚¹ï¼ˆå·²ä¿®æ­£ï¼‰

1. **ä¿®æ”¹1ï¼ˆmä¸ªæ€§åŒ–ï¼‰æ˜¯ä¿®æ­£ç†è®ºåç¦»çš„å¿…éœ€ä¿®æ”¹** âš ï¸
   - **å‘ç°**ï¼šè®ºæ–‡æ ‡å‡†æ¨¡å‹ä½¿ç”¨m_iï¼ˆä¸ªæ€§åŒ–ï¼‰ï¼Œæˆ‘ä»¬é”™è¯¯ç®€åŒ–ä¸ºmï¼ˆç»Ÿä¸€ï¼‰
   - **è¯æ®**ï¼šè®ºæ–‡å¼(4), (11), Proposition 5éƒ½æ˜ç¡®ä½¿ç”¨m_i
   - **å½±å“**ï¼šå½“å‰å®ç°æ— æ³•éªŒè¯è®ºæ–‡æ ¸å¿ƒç»“è®ºï¼ˆProposition 5ï¼‰
   - **ä¼˜å…ˆçº§**ï¼šä»P2æå‡è‡³P0ï¼Œä¸ä¿®æ”¹2åŒç­‰é‡è¦

2. **ä¿®æ”¹2ï¼ˆåˆ©æ¶¦çº¦æŸï¼‰æ˜¯å¿…éœ€çš„ç†è®ºä¿®å¤**
   - å½“å‰ä»£ç å…è®¸äºæŸç­–ç•¥ï¼Œè¿åç†æ€§å‚ä¸çº¦æŸ
   - ä¿®æ”¹ç®€å•ä½†å½±å“æ·±è¿œï¼Œç¡®ä¿ç»æµåˆç†æ€§

3. **ä¿®æ”¹3ï¼ˆç†ç”±ä¼˜åŒ–ï¼‰æ˜¯é‡è¦çš„å·¥ç¨‹æ”¹è¿›**
   - è§£å†³å¤§è§„æ¨¡å®éªŒ(N=100)çš„æç¤ºè¯çˆ†ç‚¸é—®é¢˜
   - Tokenå‡å°‘90%+ï¼Œæ•ˆç‡æ˜¾è‘—æå‡
   - ä¿¡æ¯æŸå¤±<10%ï¼Œä¸å½±å“å­¦ä¹ æ•ˆæœ

### å®æ–½è·¯çº¿å›¾ï¼ˆä¿®æ­£ç‰ˆï¼‰

```
Phase 1ï¼ˆæœ¬å‘¨ï¼Œå¿…éœ€ï¼‰: ä¿®æ”¹2 + ä¿®æ”¹1ï¼ˆæ–¹æ¡ˆBï¼‰+ ä¿®æ”¹3
  â”œâ”€ Day 1: å®ç°åˆ©æ¶¦çº¦æŸ
  â”œâ”€ Day 2-3: å®ç°ä¸ªæ€§åŒ–è¡¥å¿ï¼ˆK=3ç±»ï¼Œå¯¹é½è®ºæ–‡ï¼‰âš ï¸ æ–°å¢
  â”œâ”€ Day 4-5: å®ç°ç†ç”±èšåˆ
  â””â”€ Day 6: å›å½’æµ‹è¯•

Phase 2ï¼ˆä¸‹å‘¨ï¼ŒéªŒè¯ï¼‰: å¯¹æ¯”å®éªŒ
  â”œâ”€ Day 7-8: ç»Ÿä¸€m vs ç¦»æ•£m_iå¯¹æ¯”
  â”œâ”€ Day 9: éªŒè¯Proposition 5
  â””â”€ Day 10: æ’°å†™å¯¹æ¯”æŠ¥å‘Š

Phase 3ï¼ˆæœªæ¥ï¼Œå¯é€‰ï¼‰: ä¿®æ”¹1ï¼ˆæ–¹æ¡ˆA - å®Œå…¨ä¸ªæ€§åŒ–ï¼‰
  â””â”€ å®ç°Nç»´m_iä¼˜åŒ–ï¼ˆç ”ç©¶æ–¹å‘ï¼‰
```

âš ï¸ **å…³é”®å˜åŒ–**ï¼šä¿®æ”¹1ï¼ˆç¦»æ•£m_iï¼‰ä»Phase 2ç§»è‡³Phase 1ï¼Œå› ä¸ºè¿™æ˜¯å¯¹é½è®ºæ–‡çš„å¿…éœ€ä¿®æ”¹ã€‚

### è®ºæ–‡å¯¹é½åº¦ï¼ˆä¿®æ­£ç‰ˆï¼‰

| ä¿®æ”¹ | è®ºæ–‡ä¾æ® | å¯¹é½åº¦ | å¤‡æ³¨ |
|------|----------|--------|------|
| ä¿®æ”¹1 | Eq.(4), (11), Proposition 5 | â­â­â­â­â­ | âš ï¸ **è®ºæ–‡æ ‡å‡†è®¾å®šï¼Œå¿…éœ€å®ç°** |
| ä¿®æ”¹2 | Implicit assumption | â­â­â­â­â­ | ç†æ€§å‚ä¸çš„å¿…è¦æ¡ä»¶ |
| ä¿®æ”¹3 | Section 4.2 (Large Markets) | â­â­â­ | å·¥ç¨‹å®ç°ï¼Œè®ºæ–‡ç²¾ç¥æ”¯æŒ |

âš ï¸ **é‡å¤§ä¿®æ­£**ï¼šä¿®æ”¹1çš„å¯¹é½åº¦ä»â­â­â­â­æå‡è‡³â­â­â­â­â­ï¼Œå› ä¸ºä¸ªæ€§åŒ–è¡¥å¿m_iæ˜¯è®ºæ–‡çš„æ ‡å‡†æ¨¡å‹ï¼Œä¸æ˜¯å¯é€‰æ‰©å±•ã€‚

---

**æ–‡æ¡£ç»“æŸ**
