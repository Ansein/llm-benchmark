# LLM Benchmark 提示词设计文档

本文档记录了场景B和场景C中使用的所有LLM提示词。

---

## 场景B：Too Much Data（推断外部性）

### 1. 用户系统提示 (System Prompt)

**用途**: 为用户决策设定角色和输出格式要求

```
你是理性经济主体，目标是在不确定他人行为的情况下最大化你的期望效用。
你必须输出严格JSON格式，不要包含任何额外的文本。
```

---

### 2. 平台定价提示 (Platform Pricing Prompt) [已废弃]

**用途**: 让LLM平台选择报价策略（当前版本使用理论求解器，此提示保留仅供参考）

**条件判断**: `pricing_mode` 参数
- `"uniform"`: 统一价格模式
- 其他: 个性化价格模式（未实现）

#### 2.1 统一价格模式 (`pricing_mode == "uniform"`)

```
# 场景：数据市场平台定价（统一价格版本）

你是平台。在这一轮你将对所有用户给出**同一报价 p**（take-it-or-leave-it）。
用户将**同时决定是否分享**。你不知道每个用户的隐私偏好实现值，但知道其先验分布与外部性结构摘要。

## 公共信息

**市场规模**：
- 用户总数 n = {n}

**隐私偏好分布**（先验）：
- 所有用户的隐私偏好 v 均匀分布在 [{v_min}, {v_max}]
- 你无法观察到每个用户的具体 v 值

**相关性结构摘要**：
- 总体相关强度（等相关系数）：ρ = {rho:.2f}
- 观测噪声方差：σ² = {sigma_noise_sq}

**用户相关性分布**：
{json.dumps(corr_summary_list, indent=2, ensure_ascii=False)}

## 推断外部性机制

**核心**：用户类型相关，你买到部分数据后可以推断其他人的信息。

**泄露信息量 I_i**：
- 给定分享集合 S，对每个用户 i（包括不分享者），平台对其类型的推断精度提升量
- 通过贝叶斯更新计算：I_i(S) = Var(X_i) - Var(X_i | S)
- **关键外部性**：即使用户 i 不分享，只要其他人分享，平台也能通过相关性推断 i 的信息

**次模性**：
- 分享的人越多，新增一个用户的边际信息价值越低
- 这意味着：价格应平衡"吸引足够多人分享"与"避免过度支付"

## 你的利润函数

**利润 = 总信息价值 - 总支付**：
- U = Σ_i I_i(shares) - (#shares) × p

其中：
- Σ_i I_i(shares)：从所有用户（包括不分享者）获得的总信息价值
- (#shares) × p：支付给分享用户的总费用

**用户决策**：
- 用户 i 会比较分享与不分享的期望效用
- 效用：u_i = share × p - v_i × I_i(share, others)
- 用户基于先验与相关结构形成对"他人分享比例"的信念

## 你的任务

选择一个统一报价 p，使你的**期望利润最大化**。

**思考要点**：
1. **预期分享率**：给定价格 p，你认为会有多少比例的用户选择分享？
   - v 较低的用户更可能分享（隐私成本低）
   - 相关性越强，边际泄露越小（次模性），用户分享意愿可能下降
   
2. **价格权衡**：
   - p 太低 → 分享率低 → 信息少
   - p 太高 → 成本高 → 利润低
   
3. **外部性考虑**：
   - 高相关性 ρ={rho:.2f} 意味着：买到部分数据就能推断很多人
   - 这降低了用户分享的边际价值，但提升了你的总价值

## 输出格式

请输出严格JSON：
{{
  "uniform_price": 一个非负数（你设定的统一报价）,
  "belief_share_rate": 0到1之间的小数（你预期的分享比例）,
  "reason": "简要说明定价逻辑（不超过200字）"
}}
```

**变量说明**:
- `{n}`: 用户总数
- `{v_min}, {v_max}`: 隐私偏好分布范围 (0.3, 1.2)
- `{rho}`: 相关系数
- `{sigma_noise_sq}`: 噪声方差
- `{corr_summary_list}`: 用户相关性摘要JSON数组

---

### 3. 用户决策提示 (User Decision Prompt)

**用途**: 让LLM用户基于个性化报价做出分享决策

**条件判断**: 
- `v_level` 根据用户隐私偏好 `v_i` 相对位置决定：
  - `v_i < v_mean - 0.2` → "低"，"偏低"
  - `v_mean - 0.2 <= v_i < v_mean + 0.2` → "中"，"中等"
  - `v_i >= v_mean + 0.2` → "高"，"偏高"

**示例**: 假设 `user_id=0, v_i=0.45, price=0.3521, rho=0.7, n=10`

```
# 场景：数据市场静态博弈（推断外部性）

你是用户 0，正在参与一个**一次性的数据市场决策**。

## 基本信息

**你的私有信息**：
- 你的隐私偏好：v[0] = 0.450
- 平台给你的个性化报价：p[0] = 0.3521
  （注意：每个用户的报价可能不同，这是平台根据你的预期贡献定制的价格）

**公共知识**（所有人都知道）：
- 用户总数：n = 10
- 类型相关系数：ρ = 0.70
  （你的类型与其他用户的类型相关，相关系数为 0.70）
- 观测噪声：σ² = 0.1
- 隐私偏好分布：所有用户的 v 均匀分布在 [0.3, 1.2]
  （你的 v = 0.450，相对位置：偏低，属于低隐私偏好群体）

**你的相关性结构**：
- 你与其他人的平均相关系数：0.68
- 你最强相关的邻居：用户3(相关系数=0.72), 用户5(相关系数=0.71), 用户8(相关系数=0.70)
- 强相关邻居数量（相关系数 > 0.5）：7

**你不知道的信息**：
- 其他用户的具体 v 值（你只知道分布）
- 其他用户会如何决策（因为是同时决策）

## 推断外部性机制

**关键概念**：即使你不分享数据，平台也能通过其他人的数据推断你的信息。

**泄露信息量 I_i(a)**：
- 给定分享集合 S，平台对你的推断精度提升量
- 通过贝叶斯更新计算：I_i(S) = σ_i² - Var(X_i | S)
- **核心外部性**：I_i 不仅取决于你是否分享，还取决于其他人是否分享

**你的效用函数**：
- 如果你**分享**：u_i = p_i - v_i × I_i(你分享, 其他人的决策)
- 如果你**不分享**：u_i = 0 - v_i × I_i(你不分享, 其他人的决策)

**关键洞察**：
- 不分享也会有**基础泄露**（因为其他人分享会泄露你的信息）
- 分享的真正成本是**边际泄露** = I_i(分享) - I_i(不分享)
- 补偿价格 p_i 旨在覆盖你的边际隐私损失

## 理性预期决策框架

因为你不知道其他人会如何选择，你需要：

**1. 基于分布推测其他人的行为**：
- v 值较低的用户更可能分享（隐私成本低）
- v 值较高的用户更不可能分享（隐私成本高）
- 你的 v = 0.450，处于低水平

**2. 计算期望效用**：
- E[u_i | 分享] = E[p_i - v_i × I_i(1, a_{-i})]
- E[u_i | 不分享] = E[- v_i × I_i(0, a_{-i})]

**3. 理解次模性**：
- 分享的人越多，你的边际信息价值越低
- 基础泄露越高（别人分享多），你分享的边际泄露越小

**4. 做出最佳反应**：
- 如果 E[u_i | 分享] > E[u_i | 不分享]，则分享
- 否则不分享

## 你的任务

基于上述机制，在**不知道其他人具体决策**的情况下，通过**理性预期**判断是否分享数据。

**思考要点**：
1. 你的 v 值在分布中的位置如何？（v = 0.450，属于低群体）
2. 预期会有多少比例的用户分享？
3. 在那个预期下，你分享的边际价值是多少？
4. 报价 p = 0.3521 能否覆盖你的边际隐私损失？
5. 相关性 ρ = 0.70 如何影响外部性？

## 输出格式

请输出严格JSON：
{{
  "share": 0或1（0=不分享，1=分享），
  "belief_share_rate": 0到1之间的小数（你认为其他人分享的比例）,
  "reason": "简要说明你的权衡与信念依据（不超过150字）"
}}
```

**变量说明**:
- `{user_id}`: 用户ID
- `{v_i}`: 用户隐私偏好
- `{price}`: 平台给该用户的个性化报价
- `{n}`: 用户总数
- `{rho}`: 相关系数
- `{sigma_noise_sq}`: 噪声方差
- `{mean_corr}`: 该用户与他人的平均相关系数
- `{neighbors_str}`: TopK邻居字符串
- `{strong_neighbors_count}`: 强相关邻居数量
- `{v_level}`: "低"/"中"/"高"
- `{v_description}`: "偏低"/"中等"/"偏高"

---

## 场景C：The Economics of Social Data

### 4. 消费者决策提示 (Consumer Decision Prompt)

**用途**: 让LLM消费者决定是否参与数据分享计划

**条件判断**:
- `data_structure` 参数决定数据结构说明：
  - `"common_preferences"`: 共同偏好
  - `"common_experience"`: 共同经历

#### 示例: 假设 `theta_i=4.0, tau_i=0.8, m=0.7, anonymization="identified", data_structure="common_preferences", s_i=4.2`

```
你是消费者，需要在"参与数据分享计划"与"拒绝参与"之间做选择。你的目标是最大化你的期望净效用（补偿 + 市场结果带来的收益 − 隐私成本）。

【数据分享计划】
- 若参与：你立刻获得补偿 m = 0.70。
- 隐私机制：
  - identified：商家可能将你的数据与身份绑定，更容易对你做个性化定价（对高偏好者更可能不利）。
  - anonymized：商家只能利用匿名统计信息，通常更难针对个人定价，但仍可能从总体数据改进产品/定价。

【你的参数】
- 偏好强度 θ_i = 4.00 （越大表示你越喜欢该产品/更可能购买）
- 隐私成本 τ_i = 0.80 （参与会带来这项隐私损失成本）

【你的私人信号】
- 你的私人信号 s_i = 4.20

【数据结构说明】
- 当前结构：common_preferences
- 共同偏好：所有消费者真实偏好相同（记为 θ），你的信号满足 s_i = θ + 个体噪声。

【决策要求】
请你判断：参与是否"值得"。你不需要精确计算市场均衡，但要考虑以下要点：
1) 补偿 m 是参与的直接收益；
2) identified 可能导致对你更不利的个性化定价风险（尤其当 θ_i 较高时）；
3) anonymized 个性化定价风险较小，但补偿收益不变；
4) 参与会产生隐私成本 τ_i。

【输出格式（必须严格遵守）】
请按以下格式回答：
第1行：你的决策理由（50-100字）
第2行：决策：参与 或 决策：拒绝
```

**数据结构说明变体**:

当 `data_structure == "common_preferences"`:
```
- 当前结构：common_preferences
- 共同偏好：所有消费者真实偏好相同（记为 θ），你的信号满足 s_i = θ + 个体噪声。
```

当 `data_structure == "common_experience"`:
```
- 当前结构：common_experience
- 共同经历：每个消费者真实偏好不同（记为 θ_i），但信号含共同冲击，s_i = θ_i + ε（ε对所有人相同）。
```

**变量说明**:
- `{m}`: 补偿金额
- `{consumer_params['theta_i']}`: 消费者偏好强度
- `{consumer_params['tau_i']}`: 隐私成本
- `{anonymization}`: "identified" 或 "anonymized"
- `{s_i}`: 私人信号（可选）
- `{data_structure}`: "common_preferences" 或 "common_experience"

---

### 5. 中介策略提示 (Intermediary Strategy Prompt)

**用途**: 让LLM中介选择补偿金额和匿名化策略，支持多轮学习

**条件判断**:
- 是否有 `feedback`: 决定是否显示"上一轮结果"
- 是否有 `history`: 决定是否显示"历史记忆"

#### 5.1 无反馈无历史（第1轮）

**示例**: `N=20, mu_theta=4.0, sigma_theta=0.5, tau_mean=1.0, tau_std=0.3, data_structure="common_preferences", m_init=1.0`

```
你是"数据中介"，你的目标是最大化你的期望利润。

【市场参数】
- 消费者数量 N = 20
- 消费者偏好 θ ~ Normal(均值 4.00, 标准差 0.50)
- 消费者隐私成本 τ ~ Normal(均值 1.00, 标准差 0.30)
- 数据结构：common_preferences

【你的决策（你先动）】
你要选择：
1) 本轮补偿的改变量 Δm（范围 -0.5 到 0.5）
2) 匿名化策略：identified 或 anonymized

【消费者反应（随后）】
消费者会比较"参与的期望净收益"与其隐私成本 τ_i 来决定是否参与。
你需要权衡：identified 策略下，数据可识别性/定价精度提高，但可能降低消费者参与率；anonymized 策略下，参与率可能提高，但个性化定价能力下降。请自行权衡以最大化利润。

【你卖给商家的数据费 m0（关键）】
商家愿意为数据支付的价格 m0 由"数据带来的商家利润增量"决定：
m0 ≈ max(0, 期望[商家利润(有数据) − 商家利润(无数据)])
直觉：参与人数越多、数据越能支持个性化定价或改进产品，m0 越大，但边际收益递减。

【你的利润】
利润 = m0 − m × (参与人数)

【你的目标】
你的目标是最大化利润。请根据历史记忆，以利润最高的历史策略为基准进行微调，努力提高你的利润。

【输出格式（必须严格遵守）】
只输出一行 JSON，不要输出任何额外文字：
{"delta_m": 数字,"anonymization":"identified" 或 "anonymized","reason":"50-100字"}


上一轮 m = 1.00，本轮 m = clamp(m_prev + Δm, 0, 3)。
请给出你的选择。
```

#### 5.2 有反馈有历史（第2轮及之后）

**示例**: 假设上一轮 `m=0.5, anonymization="anonymized", r=0.0134, m0=0.4456, cost=0.134, profit=0.3116`，历史有2条记录

```
你是"数据中介"，你的目标是最大化你的期望利润。

【市场参数】
- 消费者数量 N = 20
- 消费者偏好 θ ~ Normal(均值 4.00, 标准差 0.50)
- 消费者隐私成本 τ ~ Normal(均值 1.00, 标准差 0.30)
- 数据结构：common_preferences

【你的决策（你先动）】
你要选择：
1) 本轮补偿的改变量 Δm（范围 -0.5 到 0.5）
2) 匿名化策略：identified 或 anonymized

【消费者反应（随后）】
消费者会比较"参与的期望净收益"与其隐私成本 τ_i 来决定是否参与。
你需要权衡：identified 策略下，数据可识别性/定价精度提高，但可能降低消费者参与率；anonymized 策略下，参与率可能提高，但个性化定价能力下降。请自行权衡以最大化利润。

【你卖给商家的数据费 m0（关键）】
商家愿意为数据支付的价格 m0 由"数据带来的商家利润增量"决定：
m0 ≈ max(0, 期望[商家利润(有数据) − 商家利润(无数据)])
直觉：参与人数越多、数据越能支持个性化定价或改进产品，m0 越大，但边际收益递减。

【你的利润】
利润 = m0 − m × (参与人数)

【你的目标】
你的目标是最大化利润。请根据历史记忆，以利润最高的历史策略为基准进行微调，努力提高你的利润。

【输出格式（必须严格遵守）】
只输出一行 JSON，不要输出任何额外文字：
{"delta_m": 数字,"anonymization":"identified" 或 "anonymized","reason":"50-100字"}


【上一轮结果（仅供参考）】
- m = 0.5, anonymization = anonymized
- 参与率 r = 0.0134
- m0 = 0.4456
- 补偿成本 = 0.1340
- 中介利润 = 0.3116
- 参与者理由（逐条）: ['（理性）参与：τ=0.65 <= ΔU=0.66', '（理性）参与：τ=0.58 <= ΔU=0.66']
- 拒绝者理由（逐条）: ['（理性）拒绝：τ=1.12 > ΔU=0.66', '（理性）拒绝：τ=0.94 > ΔU=0.66', ...]

【历史记忆（按利润从高到低）】
- m=0.500, anon=anonymized, r=0.013, profit=0.312
- m=0.300, anon=anonymized, r=0.003, profit=0.092

上一轮 m = 0.50，本轮 m = clamp(m_prev + Δm, 0, 3)。
请给出你的选择。
```

**变量说明**:
- `{market_params['N']}`: 消费者数量
- `{market_params['mu_theta']}`: 偏好均值
- `{market_params['sigma_theta']}`: 偏好标准差
- `{market_params['tau_mean']}`: 隐私成本均值
- `{market_params['tau_std']}`: 隐私成本标准差
- `{market_params['data_structure']}`: 数据结构
- `{m_prev}`: 上一轮的m值（第1轮为m_init）
- `{feedback.get('m')}`: 上一轮m
- `{feedback.get('anonymization')}`: 上一轮匿名化策略
- `{feedback.get('participation_rate')}`: 上一轮参与率
- `{feedback.get('m0')}`: 上一轮m0
- `{feedback.get('intermediary_cost')}`: 上一轮补偿成本
- `{feedback.get('intermediary_profit')}`: 上一轮利润
- `{reasons.get('participants')}`: 参与者理由列表
- `{reasons.get('rejecters')}`: 拒绝者理由列表
- `{history}`: 历史轮次列表（按利润降序）

---

## 提示词设计原则

### 场景B设计原则

1. **信息充分性**: 提供完整的市场参数、相关性结构、外部性机制说明
2. **零引导**: 不直接告诉LLM"应该怎么做"，只描述机制和目标
3. **理性预期**: 强调用户需要基于分布和信念推测他人行为
4. **个性化上下文**: 每个用户看到自己的v值、相关性结构、个性化报价

### 场景C设计原则

1. **充分信息 + 零引导**: 详细描述机制（identified vs anonymized, m0计算逻辑），但不提供具体计算步骤
2. **多轮学习支持**: 通过反馈和历史记忆让中介LLM逐步优化策略
3. **理由收集**: 要求LLM输出决策理由，用于反馈给中介
4. **数据结构适配**: 根据common_preferences/common_experience调整信号解释
5. **增量调整**: 中介输出delta_m而非绝对m，避免震荡

---

## 版本历史

- **v3.0** (2026-01-22): 场景C提示词从"引导计算"转为"充分信息+零引导"，中介改为输出delta_m
- **v2.0** (2026-01-20): 场景C添加多轮学习、历史记忆、消费者理由反馈
- **v1.0** (2025-12): 初始版本，场景B使用理论平台定价
