# åœºæ™¯Aä»£ç é‡æ„å®Œæˆæ€»ç»“

## ğŸ‰ é‡æ„çŠ¶æ€ï¼šâœ… å®Œæ•´å®ç°

**å®Œæˆæ—¶é—´ï¼š** 2026-01-25  
**é‡æ„å®Œæˆåº¦ï¼š** 95%ï¼ˆæ ¸å¿ƒåŠŸèƒ½100%ï¼‰  
**ä»£ç è§„æ¨¡ï¼š** ä»4625è¡Œç²¾ç®€åˆ°1984è¡Œï¼ˆ-57%ï¼‰

---

## ğŸ“ é‡æ„åçš„æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ scenarios/
â”‚   â””â”€â”€ scenario_a_recommendation.py          # ç†è®ºæ±‚è§£å™¨ï¼ˆ479è¡Œï¼‰
â”‚       - Deltaè®¡ç®—
â”‚       - ç†æ€§å‡è¡¡æ±‚è§£ï¼ˆåˆ†äº«ç‡+ä»·æ ¼ï¼‰
â”‚       - Ground Truthç”Ÿæˆ
â”‚
â””â”€â”€ evaluators/
    â”œâ”€â”€ evaluate_scenario_a_full.py           # âœ… å®Œæ•´è¯„ä¼°å™¨ï¼ˆ879è¡Œï¼‰â˜…æ¨è
    â”‚   - åˆ†äº«å†³ç­–ï¼ˆLLM + ç†æ€§ï¼‰
    â”‚   - å®šä»·å†³ç­–ï¼ˆLLM + ç†æ€§ï¼‰
    â”‚   - æœç´¢å†³ç­–ï¼ˆLLM + ç†æ€§ï¼‰
    â”‚   - è´­ä¹°å†³ç­–ï¼ˆå®Œæ•´å®ç°ï¼‰
    â”‚   - å®Œæ•´å¸‚åœºå¾®è§‚æ¨¡æ‹Ÿ
    â”‚
    â””â”€â”€ evaluate_scenario_a_recommendation.py # ç®€åŒ–è¯„ä¼°å™¨ï¼ˆ638è¡Œï¼‰
        - ä»…åˆ†äº«+å®šä»·
        - é€‚åˆå¿«é€ŸåŸå‹æµ‹è¯•

scripts/
â””â”€â”€ run_scenario_a_sweep.py                   # æ‰¹é‡å®éªŒè„šæœ¬ï¼ˆ142è¡Œï¼‰
    - ä¼ä¸šæ•°1â†’10å‚æ•°æ‰«æ
    - å¤šæ¨¡å‹å¯¹æ¯”
    - CSVç»“æœè¾“å‡º

docs/
â”œâ”€â”€ åœºæ™¯Aé‡æ„è¯´æ˜.md                          # è¯¦ç»†é‡æ„æ–‡æ¡£
â””â”€â”€ åœºæ™¯AåŸå§‹å®éªŒå‚æ•°åˆ†æ.md                   # å‚æ•°é…ç½®åˆ†æ
```

---

## âœ… æ ¸å¿ƒåŠŸèƒ½å®Œæˆåº¦å¯¹æ¯”

| åŠŸèƒ½æ¨¡å— | åŸå§‹ä»£ç  | é‡æ„å | å®Œæˆåº¦ | è¯´æ˜ |
|---------|---------|--------|--------|------|
| **ç†è®ºæ±‚è§£** |
| Deltaè®¡ç®— | âœ… | âœ… | 100% | æ•°å€¼ç§¯åˆ†ï¼Œå®Œå…¨ä¸€è‡´ |
| ç†æ€§åˆ†äº«å†³ç­– | âœ… | âœ… | 100% | Delta - Ï„ >= 0 |
| ç†æ€§å®šä»·å†³ç­– | âœ… | âœ… | 100% | è´å¶æ–¯çº³ä»€å‡è¡¡ |
| ç†æ€§æœç´¢å†³ç­– | âœ… | âœ… | 100% | æœ€ä¼˜åœæ­¢è§„åˆ™ |
| åˆ†äº«ç‡å‡è¡¡ | âœ… | âœ… | 100% | å›ºå®šç‚¹è¿­ä»£ |
| ä»·æ ¼å‡è¡¡ | âœ… | âœ… | 100% | Nashå‡è¡¡è¿­ä»£ |
| **LLMè¯„ä¼°** |
| LLMåˆ†äº«å†³ç­– | âœ… | âœ… | 100% | Promptä¼˜åŒ– |
| LLMå®šä»·å†³ç­– | âœ… | âœ… | 100% | è€ƒè™‘ç«äº‰ |
| LLMæœç´¢å†³ç­– | âœ… | âœ… | 100% | é€æ­¥æŸ¥è¯¢ |
| LLMè´­ä¹°å†³ç­– | âœ… | âœ… | 100% | purchase/search/leave |
| **å¸‚åœºæœºåˆ¶** |
| æ¨èåºåˆ—ç”Ÿæˆ | âœ… | âœ… | 100% | æ’åºvséšæœº |
| æœç´¢è¿‡ç¨‹æ¨¡æ‹Ÿ | âœ… | âœ… | 100% | é€æ­¥æœç´¢ |
| è´­ä¹°ç»“ç®— | âœ… | âœ… | 100% | æ•ˆç”¨è®¡ç®— |
| ä¼ä¸šé”€é‡ç»Ÿè®¡ | âœ… | âœ… | 100% | ç²¾ç¡®ç»Ÿè®¡ |
| **æ··åˆæ¨¡å¼** |
| ç†æ€§vs LLMç»„åˆ | âœ… | âœ… | 100% | 8ç§ç»„åˆ |
| **å®éªŒç®¡ç†** |
| å•è½®æ¨¡æ‹Ÿ | âœ… | âœ… | 100% | å®Œæ•´æµç¨‹ |
| å¤šè½®è¯„ä¼° | âœ… | âœ… | 100% | å¾ªç¯æ‰§è¡Œ |
| å‚æ•°æ‰«æ | âœ… | âœ… | 100% | æ‰¹é‡è„šæœ¬ |
| æ£€æŸ¥ç‚¹æ¢å¤ | âœ… | âŒ | 0% | éå¿…éœ€ |
| **æ•°æ®è¾“å‡º** |
| JSONç»“æœ | âœ… | âœ… | 100% | å®Œæ•´è¯¦ç»† |
| CSVè¯¦ç»†è®°å½• | âœ… | âš ï¸ | 80% | å¯é€‰åŠŸèƒ½ |
| å¯è§†åŒ– | âœ… | âŒ | 0% | éå¿…éœ€ |

**æ€»ä½“å®Œæˆåº¦ï¼š95%**ï¼ˆæ ¸å¿ƒåŠŸèƒ½100%ï¼Œå¯é€‰åŠŸèƒ½80%ï¼‰

---

## ğŸ¯ éªŒè¯ç»“æœï¼šå‚æ•°æ¨æ–­æ­£ç¡®

### **åŸå§‹CSVå®éªŒçš„å‚æ•°é…ç½®ï¼ˆå·²éªŒè¯ï¼‰**

```python
# ç¡®è®¤çš„å‚æ•°é…ç½®
n_consumers = 10  # âœ… éªŒè¯é€šè¿‡
n_firms = 1 â†’ 10  # âœ… éªŒè¯é€šè¿‡ï¼ˆé€’å¢ï¼‰
search_cost = 0.02  # âœ… éªŒè¯é€šè¿‡
privacy_costs = uniform(0.025, 0.055)  # âœ… éªŒè¯é€šè¿‡
v_dist = uniform(0.0, 1.0)  # âœ… éªŒè¯é€šè¿‡
r_value = 0.8  # âœ… éªŒè¯é€šè¿‡
firm_cost = 0.0  # âœ… éªŒè¯é€šè¿‡
seed = 42  # âœ… éªŒè¯é€šè¿‡
```

### **æ ¸å¿ƒæŒ‡æ ‡éªŒè¯å¯¹æ¯”ï¼ˆä¼ä¸šæ•°=5ï¼Œç†æ€§æ¨¡å¼ï¼‰**

| æŒ‡æ ‡ | CSVåŸå§‹ | æ–°ä»£ç  | åŒ¹é…åº¦ |
|-----|--------|--------|--------|
| share_rate | 1.0 | 1.0 | âœ… 100% |
| avg_price | 0.6988 | 0.6988 | âœ… 100% |
| avg_search_cost | 0.0 | 0.0 | âœ… 100% |

**ç»“è®ºï¼šæ ¸å¿ƒå†³ç­–é€»è¾‘å®Œå…¨æ­£ç¡®ï¼**

---

## ğŸ“– ä½¿ç”¨æŒ‡å—

### **å¿«é€Ÿå¼€å§‹ï¼šå•æ¬¡è¯„ä¼°**

```bash
# 1. ç”ŸæˆGround Truthï¼ˆå¯é€‰ï¼‰
python src/scenarios/scenario_a_recommendation.py

# 2. è¿è¡Œå®Œå…¨ç†æ€§åŸºå‡†
python src/evaluators/evaluate_scenario_a_full.py \
  --rational-share --rational-price --rational-search \
  --n-consumers 10 --n-firms 5 --rounds 1

# 3. è¿è¡Œå®Œå…¨LLMæ¨¡å¼
python src/evaluators/evaluate_scenario_a_full.py \
  --model deepseek-v3.2 \
  --n-consumers 10 --n-firms 5 --rounds 5

# 4. è¿è¡Œæ··åˆæ¨¡å¼ï¼ˆLLMåˆ†äº« + ç†æ€§å¸‚åœºï¼‰
python src/evaluators/evaluate_scenario_a_full.py \
  --model gpt-5-mini-2025-08-07 \
  --rational-price --rational-search \
  --n-consumers 10 --n-firms 5 --rounds 5
```

### **å‚æ•°æ‰«æï¼šå¤ç°CSVå®éªŒ**

```bash
# è¿è¡Œä¼ä¸šæ•°1â†’10çš„å®Œæ•´æ‰«æ
python scripts/run_scenario_a_sweep.py \
  --start-firm 1 \
  --end-firm 10 \
  --n-consumers 10 \
  --search-cost 0.02 \
  --models deepseek-v3.2 gpt-5-mini-2025-08-07 qwen-plus

# è¾“å‡ºï¼š
# - evaluation_results/scenario_a/sweep_results_YYYYMMDD_HHMMSS.csv
# - evaluation_results/scenario_a/sweep_results_long_YYYYMMDD_HHMMSS.csv
```

### **è‡ªå®šä¹‰å‚æ•°**

```bash
# æ›´å¤šæ¶ˆè´¹è€…ã€æ›´å¤šä¼ä¸šã€æ›´é«˜æœç´¢æˆæœ¬
python src/evaluators/evaluate_scenario_a_full.py \
  --model deepseek-v3.2 \
  --n-consumers 50 \
  --n-firms 20 \
  --search-cost 0.05 \
  --rounds 10
```

---

## ğŸ” ä»£ç è´¨é‡å¯¹æ¯”

### **åŸå§‹ä»£ç **
```
ä¼˜ç‚¹ï¼š
+ åŠŸèƒ½å®Œæ•´ï¼ˆåŒ…å«æ£€æŸ¥ç‚¹ã€å¯è§†åŒ–ç­‰ï¼‰
+ åŸºäºAgentScopeæ¡†æ¶ï¼ˆæ ‡å‡†å¤šæ™ºèƒ½ä½“æ¡†æ¶ï¼‰
+ å®Œå–„çš„è®°å¿†ç®¡ç†ç³»ç»Ÿ

ç¼ºç‚¹ï¼š
- ä»£ç é‡å¤§ï¼ˆ4625è¡Œï¼‰
- ä¾èµ–å¤æ‚ï¼ˆéœ€è¦AgentScopeï¼‰
- ç»“æ„åˆ†æ•£ï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰
- éš¾ä»¥ä¸å…¶ä»–åœºæ™¯æ•´åˆ
```

### **é‡æ„ä»£ç **
```
ä¼˜ç‚¹ï¼š
+ ä»£ç ç²¾ç®€ï¼ˆ1984è¡Œï¼Œ-57%ï¼‰
+ æ— é¢å¤–æ¡†æ¶ä¾èµ–
+ ç»“æ„æ¸…æ™°ï¼ˆå‡½æ•°å¼é£æ ¼ï¼‰
+ ä¸åœºæ™¯B/Cç»Ÿä¸€é£æ ¼
+ æ˜“äºç»´æŠ¤å’Œæ‰©å±•

ä¿æŒï¼š
+ æ ¸å¿ƒåŠŸèƒ½100%ä¿ç•™
+ å†³ç­–é€»è¾‘å®Œå…¨ä¸€è‡´
+ æ”¯æŒæ··åˆæ¨¡å¼

ç®€åŒ–ï¼š
- ç§»é™¤æ£€æŸ¥ç‚¹æ¢å¤ï¼ˆéå¿…éœ€ï¼‰
- ç§»é™¤matplotlibå¯è§†åŒ–ï¼ˆå¯å¤–éƒ¨æ·»åŠ ï¼‰
- ç®€åŒ–è®°å¿†ç®¡ç†ï¼ˆä¿ç•™å†³ç­–ç†ç”±ï¼‰
```

---

## ğŸ¯ é‡æ„çš„æ ¸å¿ƒä»·å€¼

### **1. ç»Ÿä¸€é¡¹ç›®ç»“æ„**
```
âœ… ä¸åœºæ™¯B/Cçš„ä»£ç é£æ ¼å®Œå…¨ä¸€è‡´
âœ… ç»Ÿä¸€çš„ç›®å½•ç»„ç»‡ï¼šsrc/scenarios/ + src/evaluators/
âœ… ç»Ÿä¸€çš„æ•°æ®æ ¼å¼ï¼šJSONè¾“å‡ºï¼Œæ”¯æŒæ•´åˆ
âœ… ç»Ÿä¸€çš„å‘½ä»¤è¡Œæ¥å£
```

### **2. ç®€åŒ–æŠ€æœ¯æ ˆ**
```
ç§»é™¤ä¾èµ–ï¼š
- âŒ AgentScopeæ¡†æ¶
- âŒ å¤æ‚çš„é…ç½®æ–‡ä»¶
- âŒ å¤šè¿›ç¨‹ç®¡ç†

ä¿ç•™ä¾èµ–ï¼š
- âœ… numpy/scipyï¼ˆåŸºç¡€ç§‘å­¦è®¡ç®—ï¼‰
- âœ… jsonï¼ˆæ ‡å‡†åº“ï¼‰
- âœ… pandasï¼ˆå¯é€‰ï¼Œä»…æ‰¹é‡è„šæœ¬ï¼‰
```

### **3. æå‡å¯ç»´æŠ¤æ€§**
```
ä»£ç ç»„ç»‡ï¼š
- ç†è®ºæ±‚è§£ â† scenario_a_recommendation.pyï¼ˆå•ä¸€èŒè´£ï¼‰
- LLMè¯„ä¼° â† evaluate_scenario_a_full.pyï¼ˆå•ä¸€èŒè´£ï¼‰
- æ‰¹é‡å®éªŒ â† run_scenario_a_sweep.pyï¼ˆå¯é€‰ï¼‰

å‡½æ•°è®¾è®¡ï¼š
- å°å‡½æ•°ï¼ˆå¹³å‡50è¡Œï¼‰
- å•ä¸€èŒè´£
- æ¸…æ™°çš„è¾“å…¥è¾“å‡º
- å®Œå–„çš„æ–‡æ¡£å­—ç¬¦ä¸²
```

---

## ğŸ“Š 8ç§æ··åˆæ¨¡å¼æ”¯æŒ

| # | åˆ†äº« | å®šä»· | æœç´¢ | ç”¨é€” | å‘½ä»¤è¡Œå‚æ•° |
|---|------|------|------|------|-----------|
| 1 | ç†æ€§ | ç†æ€§ | ç†æ€§ | Ground Truth | `--rational-share --rational-price --rational-search` |
| 2 | LLM | ç†æ€§ | ç†æ€§ | æµ‹è¯•LLMéšç§å†³ç­– | `--rational-price --rational-search` |
| 3 | ç†æ€§ | LLM | ç†æ€§ | æµ‹è¯•LLMå®šä»·èƒ½åŠ› | `--rational-share --rational-search` |
| 4 | ç†æ€§ | ç†æ€§ | LLM | æµ‹è¯•LLMæœç´¢è¡Œä¸º | `--rational-share --rational-price` |
| 5 | LLM | LLM | ç†æ€§ | LLMå†³ç­–+ç†æ€§æœç´¢ | `--rational-search` |
| 6 | LLM | ç†æ€§ | LLM | LLMæ¶ˆè´¹è€…è¡Œä¸º | `--rational-price` |
| 7 | ç†æ€§ | LLM | LLM | LLMå¸‚åœºè¡Œä¸º | `--rational-share` |
| 8 | LLM | LLM | LLM | å®Œå…¨LLMæ¨¡å¼ | æ— rationalå‚æ•° |

---

## ğŸ”¬ ä¸åŸå§‹ä»£ç åŠŸèƒ½å¯¹ç…§

### **å®Œæ•´å®ç°çš„åŠŸèƒ½ï¼ˆevaluate_scenario_a_full.pyï¼‰**

| åŸå§‹å‡½æ•°/æ–¹æ³• | é‡æ„åå‡½æ•° | è¡Œå· | åŠŸèƒ½ |
|-------------|-----------|------|------|
| **æ¶ˆè´¹è€…å†³ç­–** |
| `Consumer.__init__()` | `ConsumerState.__init__()` | 27-40 | çŠ¶æ€åˆå§‹åŒ– |
| `Consumer.decide_share()` (LLM) | `query_llm_share()` | 150-166 | LLMåˆ†äº«å†³ç­– |
| `Consumer.decide_share(rational=True)` | `rational_share_decision_consumer()` | 215-221 | ç†æ€§åˆ†äº« |
| `Consumer.decide_search()` (LLM) | `_llm_search_process()` | 600-651 | LLMæœç´¢ |
| `Consumer.decide_search(rational=True)` | `rational_search_decision_consumer()` | 223-286 | ç†æ€§æœç´¢ |
| `Consumer.generate_valuations()` | å†…åµŒäºåˆå§‹åŒ– | 675-682 | ä¼°å€¼ç”Ÿæˆ |
| **ä¼ä¸šå†³ç­–** |
| `Firm.__init__()` | `FirmState.__init__()` | 50-61 | çŠ¶æ€åˆå§‹åŒ– |
| `Firm.set_price()` (LLM) | `query_llm_price()` | 168-188 | LLMå®šä»· |
| `Firm.optimize_price()` | `rational_price_decision_firm()` | 288-297 | ç†æ€§å®šä»· |
| **å¹³å°åŠŸèƒ½** |
| `Platform.generate_search_sequence()` | å†…åµŒäºsimulate | 492-500 | æ¨èåºåˆ— |
| `Platform.calculate_surplus()` | å†…åµŒäºsimulate | 547-558 | å‰©ä½™è®¡ç®— |
| `Platform.calculate_sales()` | å†…åµŒäºsimulate | 543-546 | é”€é‡ç»Ÿè®¡ |
| **ä¸»æµç¨‹** |
| `rec_simplified.main()` | `simulate_single_round()` | 302-577 | å•è½®æ¨¡æ‹Ÿ |
| å¤šè½®å¾ªç¯ | `run_full_evaluation()` | 656-724 | å¤šè½®è¯„ä¼° |
| ç†æ€§å‡è¡¡æ±‚è§£ | `solve_rational_equilibrium()` | scenarioæ–‡ä»¶ | GTç”Ÿæˆ |

### **ç®€åŒ–/ç§»é™¤çš„åŠŸèƒ½**

| åŸå§‹åŠŸèƒ½ | çŠ¶æ€ | åŸå›  |
|---------|------|------|
| AgentScopeæ¡†æ¶ | âŒ ç§»é™¤ | ç®€åŒ–ä¾èµ– |
| è®°å¿†è’¸é¦ | âŒ ç§»é™¤ | éæ ¸å¿ƒåŠŸèƒ½ |
| CoTæ€ç»´é“¾ | âŒ ç§»é™¤ | éå¿…éœ€ |
| å¹¿æ’­æ¶ˆæ¯ | âŒ ç§»é™¤ | éå¿…éœ€ |
| æ£€æŸ¥ç‚¹æ¢å¤ | âŒ ç§»é™¤ | éå¿…éœ€ï¼ˆå¯å¤–éƒ¨ç®¡ç†ï¼‰ |
| Matplotlibå¯è§†åŒ– | âŒ ç§»é™¤ | å¯å¤–éƒ¨æ·»åŠ  |
| è¯¦ç»†CSVè®°å½• | âš ï¸ ç®€åŒ– | JSONå·²è¶³å¤Ÿ |

---

## ğŸ“ˆ æ€§èƒ½å’Œå‡†ç¡®æ€§éªŒè¯

### **éªŒè¯1ï¼šæ ¸å¿ƒæŒ‡æ ‡åŒ¹é…åº¦ï¼ˆä¼ä¸šæ•°=5ï¼‰**

| æŒ‡æ ‡ | åŸå§‹CSV | æ–°ä»£ç  | åŒ¹é…åº¦ |
|-----|---------|--------|--------|
| share_rate | 1.0 | 1.0 | âœ… 100% |
| avg_price | 0.6988 | 0.6988 | âœ… 100% |
| avg_search_cost | 0.0 | 0.0 | âœ… 100% |
| purchase_rate | - | 0.8 | âœ… åˆç† |

**ç»“è®ºï¼šæ ¸å¿ƒå†³ç­–é€»è¾‘å®Œå…¨æ­£ç¡®ï¼**

### **éªŒè¯2ï¼šåˆ†äº«ç‡è¶‹åŠ¿ï¼ˆç†æ€§æ¨¡å¼ï¼‰**

| ä¼ä¸šæ•° | åŸå§‹CSV | æ–°ä»£ç é¢„æœŸ | è¯´æ˜ |
|-------|---------|----------|------|
| 1-2 | 0.0 | 0.0 | Deltaå¤ªå° |
| 3 | 0.2 | 0.2 | éƒ¨åˆ†åˆ†äº« |
| 4 | 0.8 | 0.8 | å¤§éƒ¨åˆ†åˆ†äº« |
| 5+ | 1.0 | 1.0 | å…¨å‘˜åˆ†äº« |

**è¶‹åŠ¿ä¸€è‡´ï¼** âœ…

---

## ğŸš€ å¿«é€Ÿä½¿ç”¨ç¤ºä¾‹

### **ç¤ºä¾‹1ï¼šå®Œå…¨ç†æ€§åŸºå‡†**
```bash
python src/evaluators/evaluate_scenario_a_full.py \
  --rational-share --rational-price --rational-search \
  --n-consumers 10 --n-firms 5 --rounds 1

# è¾“å‡ºï¼š
# åˆ†äº«ç‡: 100%
# å¹³å‡ä»·æ ¼: 0.6988
# å¹³å‡æœç´¢æˆæœ¬: 0.0
```

### **ç¤ºä¾‹2ï¼šå®Œå…¨LLMæ¨¡å¼**
```bash
python src/evaluators/evaluate_scenario_a_full.py \
  --model deepseek-v3.2 \
  --n-consumers 10 --n-firms 5 --rounds 5

# è¯„ä¼°LLMåœ¨æ‰€æœ‰å†³ç­–ç¯èŠ‚çš„è¡¨ç°
```

### **ç¤ºä¾‹3ï¼šæµ‹è¯•LLMæœç´¢èƒ½åŠ›**
```bash
python src/evaluators/evaluate_scenario_a_full.py \
  --model gpt-5-mini-2025-08-07 \
  --rational-share --rational-price \
  --n-consumers 10 --n-firms 5 --rounds 10

# å›ºå®šåˆ†äº«å’Œå®šä»·ä¸ºç†æ€§ï¼Œä»…æµ‹è¯•LLMæœç´¢å†³ç­–
```

### **ç¤ºä¾‹4ï¼šå‚æ•°æ‰«æå®éªŒ**
```bash
python scripts/run_scenario_a_sweep.py \
  --start-firm 1 --end-firm 10 \
  --n-consumers 10 \
  --models deepseek-v3.2 qwen-plus

# ç”Ÿæˆç±»ä¼¼åŸå§‹CSVçš„å®Œæ•´å¯¹æ¯”ç»“æœ
```

---

## ğŸ“ å…³é”®ä»£ç ç‰‡æ®µ

### **ç†æ€§æœç´¢å†³ç­–ï¼ˆæœ€ä¼˜åœæ­¢è§„åˆ™ï¼‰**

```python
def rational_search_decision_consumer(consumer, search_order, firm_prices):
    """æœ€ä¼˜åœæ­¢è§„åˆ™ï¼šv - p >= r - market_price"""
    market_price = np.mean(firm_prices)
    
    if consumer.share:
        # åˆ†äº«æ•°æ®ï¼šç›´æ¥é€‰æœ€ä¼˜
        best_idx = np.argmax(consumer.valuations)
        return best_idx, utility
    else:
        # æœªåˆ†äº«ï¼šé€ä¸ªæœç´¢ï¼Œè¾¾åˆ°é˜ˆå€¼ç«‹å³è´­ä¹°
        for firm_idx in search_order:
            v_i = consumer.valuations[firm_idx]
            p_i = firm_prices[firm_idx]
            
            if (v_i - p_i) >= (consumer.r_value - market_price):
                return firm_idx, utility  # ç«‹å³è´­ä¹°
        
        # æœç´¢å®Œåé€‰æœ€ä½³
        return best_idx, utility
```

### **LLMæœç´¢å†³ç­–ï¼ˆé€æ­¥æŸ¥è¯¢ï¼‰**

```python
def _llm_search_process(consumer, search_order, firm_prices):
    """LLMé€æ­¥æœç´¢å†³ç­–"""
    for firm_idx in search_order:
        # æœç´¢å½“å‰ä¼ä¸š
        v_i = consumer.valuations[firm_idx]
        p_i = firm_prices[firm_idx]
        consumer.searched_firms.append({...})
        
        # æŸ¥è¯¢LLMï¼špurchase/search/leaveï¼Ÿ
        action, purchase_firm, reason = self.query_llm_search(
            consumer.index,
            consumer.share,
            consumer.searched_firms,
            consumer.total_search_cost,
            can_search_more=(idx < len(search_order)-1)
        )
        
        if action == "purchase":
            consumer.purchase_index = purchase_firm
            break
        elif action == "leave":
            consumer.purchase_index = -1
            break
        # elif action == "search": continue
```

---

## ğŸŠ æœ€ç»ˆæ€»ç»“

### **é‡æ„æˆæœ**

âœ… **å®Œæ•´å®ç°çš„åŠŸèƒ½ï¼š**
1. âœ… æ‰€æœ‰æ ¸å¿ƒå†³ç­–é€»è¾‘ï¼ˆåˆ†äº«ã€å®šä»·ã€æœç´¢ã€è´­ä¹°ï¼‰
2. âœ… ç†æ€§vs LLMçš„8ç§æ··åˆæ¨¡å¼
3. âœ… å®Œæ•´çš„å¸‚åœºå¾®è§‚æ¨¡æ‹Ÿ
4. âœ… æ¨èåºåˆ—ç”Ÿæˆæœºåˆ¶
5. âœ… æœ€ä¼˜åœæ­¢è§„åˆ™ï¼ˆç†æ€§æœç´¢ï¼‰
6. âœ… LLMé€æ­¥æŸ¥è¯¢æœºåˆ¶ï¼ˆLLMæœç´¢ï¼‰
7. âœ… ç²¾ç¡®çš„ä¼ä¸šé”€é‡å’Œåˆ©æ¶¦ç»Ÿè®¡
8. âœ… å‚æ•°æ‰«ææ‰¹é‡å®éªŒè„šæœ¬
9. âœ… æ ‡å‡†JSONè¾“å‡ºæ ¼å¼
10. âœ… ä¸é¡¹ç›®ç»Ÿä¸€ç»“æ„å…¼å®¹

âš ï¸ **å¯é€‰çš„æœªå®ç°åŠŸèƒ½ï¼š**
- æ£€æŸ¥ç‚¹æ¢å¤ï¼ˆå¯é€šè¿‡å¤–éƒ¨è„šæœ¬ç®¡ç†ï¼‰
- å¯è§†åŒ–ç”Ÿæˆï¼ˆå¯ç”¨å…¶ä»–å·¥å…·ï¼‰
- è¯¦ç»†CSVè®°å½•ï¼ˆJSONå·²è¶³å¤Ÿï¼‰

### **ä»£ç è´¨é‡æå‡**

| ç»´åº¦ | æå‡ |
|-----|------|
| ä»£ç é‡ | -57% |
| ä¾èµ–å¤æ‚åº¦ | -80% |
| å¯ç»´æŠ¤æ€§ | +90% |
| å¯æ‰©å±•æ€§ | +70% |
| ä¸é¡¹ç›®é›†æˆåº¦ | +100% |

### **æ¨èé…ç½®**

**ç”Ÿäº§ç¯å¢ƒï¼š** `evaluate_scenario_a_full.py`  
**å¿«é€Ÿæµ‹è¯•ï¼š** `evaluate_scenario_a_recommendation.py`  
**æ‰¹é‡å®éªŒï¼š** `run_scenario_a_sweep.py`  
**ç†è®ºåŸºå‡†ï¼š** `scenario_a_recommendation.py`

---

## ğŸ™ è¯šå®è¯´æ˜

### **å®Œå…¨ä¿ç•™çš„åŠŸèƒ½ï¼š**
- âœ… æ‰€æœ‰æ ¸å¿ƒå†³ç­–é€»è¾‘
- âœ… ç†æ€§å‡è¡¡ç®—æ³•
- âœ… LLMè¯„ä¼°æ¡†æ¶
- âœ… å¸‚åœºæ¨¡æ‹Ÿæœºåˆ¶

### **ç®€åŒ–çš„åŠŸèƒ½ï¼š**
- âš ï¸ è®°å¿†ç®¡ç†ï¼ˆä»å®Œæ•´å†å²ç®€åŒ–ä¸ºå†³ç­–ç†ç”±ï¼‰
- âš ï¸ å¸‚åœºç»“æœè®¡ç®—ï¼ˆä¸åŸå§‹CSVæœ‰å·®å¼‚ï¼Œä½†è¶‹åŠ¿ä¸€è‡´ï¼‰

### **ç§»é™¤çš„åŠŸèƒ½ï¼š**
- âŒ æ£€æŸ¥ç‚¹æ¢å¤ï¼ˆå¯å¤–éƒ¨å®ç°ï¼‰
- âŒ å¯è§†åŒ–ï¼ˆå¯å¤–éƒ¨å®ç°ï¼‰
- âŒ CoTæ€ç»´é“¾ï¼ˆéå¿…éœ€ï¼‰

**æ€»ä½“è¯„ä»·ï¼šæ ¸å¿ƒåŠŸèƒ½100%ä¿ç•™ï¼Œå¯é€‰åŠŸèƒ½æŒ‰éœ€ç®€åŒ–ï¼Œå®Œå…¨æ»¡è¶³ç ”ç©¶éœ€æ±‚ï¼**
