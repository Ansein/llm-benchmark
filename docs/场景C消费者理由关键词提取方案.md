# åœºæ™¯Cï¼šæ¶ˆè´¹è€…ç†ç”±å…³é”®è¯æå–æ–¹æ¡ˆ

## ğŸ“‹ ç›®æ ‡

**é—®é¢˜**ï¼šè¿­ä»£å†å²ä¸­æ¶ˆè´¹è€…ç†ç”±æ–‡æœ¬è¿‡é•¿ï¼Œå¯¼è‡´ä¸­ä»‹LLMæç¤ºè¯è¶…é•¿
**è§£å†³æ–¹æ¡ˆ**ï¼šæå–å…³é”®è¯ï¼Œå‹ç¼©æç¤ºè¯é•¿åº¦ï¼ŒåŒæ—¶ä¿ç•™æ ¸å¿ƒä¿¡æ¯

---

## ğŸ¯ å…³é”®è¯è¯è¡¨è®¾è®¡åŸåˆ™

### 1. **åˆ†ç±»è®¾è®¡**

æŒ‰**å‚ä¸å†³ç­–**åˆ†ä¸ºä¸¤å¤§ç±»ï¼š
- **å‚ä¸ç†ç”±**ï¼ˆPARTICIPATE_KEYWORDSï¼‰
- **ä¸å‚ä¸ç†ç”±**ï¼ˆNOT_PARTICIPATE_KEYWORDSï¼‰

### 2. **ç»´åº¦è®¾è®¡**

æ¯ç±»åŒ…å«å¤šä¸ªç»´åº¦ï¼Œæ¯ä¸ªç»´åº¦åŒ…å«å¤šä¸ªå…³é”®è¯æ¨¡å¼ï¼š

#### å‚ä¸ç†ç”±ç»´åº¦ï¼š

| ç»´åº¦ç±»åˆ« | è¯´æ˜ | ç¤ºä¾‹å…³é”®è¯ |
|---------|------|-----------|
| **compensation** | ç»æµåŠ¨æœº | è¡¥å¿ã€æ”¯ä»˜ã€é‡‘é’±ã€æ”¶ç›Š |
| **benefit** | åˆ©ç›Šæ„ŸçŸ¥ | æœ‰åˆ©ã€å¥½å¤„ã€ä»·å€¼ |
| **worth** | ä»·å€¼åˆ¤æ–­ | å€¼å¾—ã€åˆ’ç®—ã€åˆç®— |
| **data_quality** | æ•°æ®è´¨é‡ | æ•°æ®è´¨é‡ã€ä¿¡å·å‡†ç¡® |
| **low_privacy_cost** | éšç§æˆæœ¬ä½ | éšç§æˆæœ¬ä½ã€ä¸åœ¨æ„éšç§ |
| **trust** | ä¿¡ä»»æ„Ÿ | ä¿¡ä»»ã€æ”¾å¿ƒã€å®‰å…¨ |
| **help_others** | åˆ©ä»–åŠ¨æœº | å¸®åŠ©ä»–äººã€è´¡çŒ®ç¤¾ä¼š |
| **others_participate** | ä»ä¼—æ•ˆåº” | åˆ«äººå‚ä¸ã€å¤§å®¶éƒ½å‚ä¸ |
| **anonymized** | åŒ¿åä¿æŠ¤ | åŒ¿åã€éšè—èº«ä»½ |

#### ä¸å‚ä¸ç†ç”±ç»´åº¦ï¼š

| ç»´åº¦ç±»åˆ« | è¯´æ˜ | ç¤ºä¾‹å…³é”®è¯ |
|---------|------|-----------|
| **privacy_concern** | éšç§æ‹…å¿§ | éšç§ã€ä¸ªäººä¿¡æ¯ã€éšç§æ³„éœ² |
| **privacy_cost_high** | éšç§æˆæœ¬é«˜ | éšç§æˆæœ¬é«˜ã€éšç§ä»£ä»· |
| **not_trust** | ä¸ä¿¡ä»» | ä¸ä¿¡ä»»ã€ä¸æ”¾å¿ƒã€æ‹…å¿ƒ |
| **low_compensation** | è¡¥å¿ä½ | è¡¥å¿å¤ªä½ã€é’±å¤ªå°‘ |
| **not_worth** | ä¸å€¼å¾— | ä¸å€¼å¾—ã€ä¸åˆ’ç®— |
| **low_data_value** | æ•°æ®ä»·å€¼ä½ | æ•°æ®ä»·å€¼ä½ã€ä¿¡æ¯æ— ç”¨ |
| **identified** | èº«ä»½è¯†åˆ«æ‹…å¿§ | èº«ä»½è¯†åˆ«ã€æš´éœ²èº«ä»½ |
| **discrimination** | æ­§è§†æ‹…å¿§ | æ­§è§†ã€å·®åˆ«å¯¹å¾… |

---

## ğŸ”§ å…³é”®è¯è¯è¡¨åˆ¶ä½œæµç¨‹

### æ–¹æ³•1ï¼šä¸“å®¶è®¾è®¡ï¼ˆæ¨èç”¨äºåˆå§‹ç‰ˆæœ¬ï¼‰

#### æ­¥éª¤1ï¼šæ”¶é›†ç†è®ºä¾æ®
å‚è€ƒè®ºæ–‡ä¸­çš„æ¶ˆè´¹è€…æ•ˆç”¨å‡½æ•°ï¼š
```
Uáµ¢(å‚ä¸) = -(w - Î¸áµ¢)Â² + m - Ï„
Uáµ¢(ä¸å‚ä¸) = -(wâ‚€ - Î¸áµ¢)Â²
```

å½±å“å› ç´ ï¼š
- âœ… **è¡¥å¿ m**ï¼šè¶Šé«˜è¶Šå€¾å‘å‚ä¸
- âœ… **éšç§æˆæœ¬ Ï„**ï¼šè¶Šé«˜è¶Šä¸å‚ä¸
- âœ… **æ•°æ®è´¨é‡**ï¼šä¿¡å·å‡†ç¡®æ€§å½±å“å®šä»·ç²¾åº¦
- âœ… **åŒ¿ååŒ–**ï¼šidentified vs anonymized
- âœ… **å‚ä¸ç‡ r**ï¼šå½±å“æ•°æ®ä»·å€¼

#### æ­¥éª¤2ï¼šå¤´è„‘é£æš´å…³é”®è¯
åŸºäºç†è®ºå› ç´ ï¼Œåˆ—ä¸¾æ¶ˆè´¹è€…å¯èƒ½çš„ç†ç”±ï¼š

**å‚ä¸ç†ç”±**ï¼š
```python
- è¡¥å¿ç›¸å…³ï¼š"è¡¥å¿é«˜"ã€"é’±å¤Ÿå¤š"ã€"æ”¶ç›Šå¤§"
- éšç§ç›¸å…³ï¼š"åŒ¿åä¿æŠ¤"ã€"éšç§æˆæœ¬ä½"
- ç­–ç•¥ç›¸å…³ï¼š"åˆ«äººéƒ½å‚ä¸"ã€"æ•°æ®æœ‰ä»·å€¼"
```

**ä¸å‚ä¸ç†ç”±**ï¼š
```python
- è¡¥å¿ç›¸å…³ï¼š"è¡¥å¿å¤ªä½"ã€"ä¸åˆ’ç®—"
- éšç§ç›¸å…³ï¼š"æ‹…å¿ƒéšç§"ã€"ä¸ä¿¡ä»»"
- ç­–ç•¥ç›¸å…³ï¼š"åˆ«äººä¸å‚ä¸"ã€"æ•°æ®æ— ç”¨"
```

#### æ­¥éª¤3ï¼šç»„ç»‡ä¸ºå±‚çº§ç»“æ„
```python
PARTICIPATE_KEYWORDS = {
    "compensation": ["è¡¥å¿", "æ”¯ä»˜", "é‡‘é’±", "æ”¶ç›Š", "æŠ¥é…¬"],
    "benefit": ["æœ‰åˆ©", "å¥½å¤„", "æ”¶ç›Š"],
    # ...
}
```

---

### æ–¹æ³•2ï¼šæ•°æ®é©±åŠ¨ï¼ˆç”¨äºä¼˜åŒ–è¿­ä»£ï¼‰

#### æ­¥éª¤1ï¼šæ”¶é›†å®é™…è¯­æ–™

è¿è¡Œä¸€æ‰¹LLMå®éªŒï¼Œæ”¶é›†æ¶ˆè´¹è€…çš„ç†ç”±ï¼š

```python
# è¿è¡Œåœºæ™¯Cå®éªŒ
python run_scenario_c_benchmark.py --num_samples 100

# æå–ç†ç”±
reasons_participate = []
reasons_not_participate = []

for record in results:
    if record['participation']:
        reasons_participate.append(record['reason'])
    else:
        reasons_not_participate.append(record['reason'])
```

#### æ­¥éª¤2ï¼šç»Ÿè®¡é«˜é¢‘è¯/çŸ­è¯­

```python
from src.scenarios.scenario_c_reason_keywords import extract_frequent_phrases

# æå–å‚ä¸ç†ç”±çš„é«˜é¢‘çŸ­è¯­
frequent_participate = extract_frequent_phrases(
    reasons_participate,
    min_frequency=5,  # è‡³å°‘å‡ºç°5æ¬¡
    max_phrase_length=10
)

print("é«˜é¢‘å‚ä¸ç†ç”±çŸ­è¯­ï¼š")
for phrase, count in frequent_participate[:20]:
    print(f"  {phrase}: {count}æ¬¡")
```

#### æ­¥éª¤3ï¼šäººå·¥å®¡æ ¸å’Œåˆ†ç±»

æŸ¥çœ‹é«˜é¢‘çŸ­è¯­ï¼Œå½’ç±»åˆ°åˆé€‚çš„ç»´åº¦ï¼š
```
"è¡¥å¿è¶³å¤Ÿ" â†’ compensation
"éšç§ä¿æŠ¤" â†’ privacy_protected
"æ•°æ®ä»·å€¼" â†’ data_quality
```

#### æ­¥éª¤4ï¼šæ›´æ–°è¯è¡¨

```python
# æ·»åŠ æ–°å‘ç°çš„å…³é”®è¯
PARTICIPATE_KEYWORDS["compensation"].extend([
    "è¡¥å¿è¶³å¤Ÿ", "æŠ¥é…¬åˆç†"
])
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

```python
from src.scenarios.scenario_c_reason_keywords import (
    extract_keywords_regex,
    summarize_iteration_history,
    format_keywords_for_intermediary_prompt
)

# å•æ¡ç†ç”±æå–
reason = "è¡¥å¿è¶³å¤Ÿé«˜ï¼Œè€Œä¸”åŒ¿åä¿æŠ¤å¾ˆå¥½ï¼Œå€¼å¾—å‚ä¸"
keywords = extract_keywords_regex(reason, participation=True)
print(keywords)
# è¾“å‡º: ['compensation', 'anonymized', 'worth']

# æ‰¹é‡å¤„ç†è¿­ä»£å†å²
iteration_history = [
    {
        'iteration': 1,
        'consumer_id': 0,
        'participation': True,
        'reason': 'è¡¥å¿è¶³å¤Ÿé«˜ï¼Œå€¼å¾—åˆ†äº«æ•°æ®',
        'm': 1.0,
        'anonymization': 'anonymized'
    },
    # ... æ›´å¤šè®°å½•
]

summary = summarize_iteration_history(
    iteration_history,
    use_keywords=True,
    max_keywords_per_category=5
)

# ç”Ÿæˆä¸­ä»‹æç¤ºè¯
prompt = format_keywords_for_intermediary_prompt(summary)
print(prompt)
```

**è¾“å‡ºç¤ºä¾‹**ï¼š
```
**å‚ä¸ç†ç”±** (å…±15æ¡):
  - compensation: 8æ¬¡
  - worth: 5æ¬¡
  - anonymized: 3æ¬¡

**ä¸å‚ä¸ç†ç”±** (å…±5æ¡):
  - privacy_concern: 3æ¬¡
  - low_compensation: 2æ¬¡

**ç»Ÿè®¡ä¿¡æ¯**:
  - æ€»è®°å½•æ•°: 20
  - å‚ä¸ç‡: 75.0%
```

### 2. é›†æˆåˆ°ä¸­ä»‹å†³ç­–æµç¨‹

```python
def intermediary_decide_with_keywords(
    iteration_history,
    current_m,
    current_anonymization
):
    """ä¸­ä»‹å†³ç­–ï¼ˆä½¿ç”¨å…³é”®è¯ä¼˜åŒ–ï¼‰"""
    
    # æå–å…³é”®è¯æ€»ç»“
    summary = summarize_iteration_history(
        iteration_history,
        use_keywords=True
    )
    
    # æ ¼å¼åŒ–ä¸ºæç¤ºè¯
    history_summary = format_keywords_for_intermediary_prompt(summary)
    
    # æ„å»ºä¸­ä»‹æç¤ºè¯
    intermediary_prompt = f"""
ä½ æ˜¯æ•°æ®ä¸­ä»‹ï¼Œéœ€è¦å†³å®šä¸‹ä¸€è½®çš„ç­–ç•¥ã€‚

## å½“å‰ç­–ç•¥
- è¡¥å¿: {current_m}
- åŒ¿ååŒ–: {current_anonymization}

## å†å²åé¦ˆï¼ˆå…³é”®è¯æ€»ç»“ï¼‰
{history_summary}

## è¯·å†³ç­–
åŸºäºä»¥ä¸Šä¿¡æ¯ï¼Œå†³å®šä¸‹ä¸€è½®ç­–ç•¥...
"""
    
    # è°ƒç”¨LLM
    response = call_llm(intermediary_prompt)
    return response
```

---

## ğŸ“Š æ•ˆæœè¯„ä¼°

### å‹ç¼©æ¯”åˆ†æ

```python
from src.scenarios.scenario_c_reason_keywords import analyze_compression_ratio

# åˆ†æå‹ç¼©æ•ˆæœ
analysis = analyze_compression_ratio(iteration_history)

print(f"åŸå§‹é•¿åº¦: {analysis['original_length']} å­—ç¬¦")
print(f"å‹ç¼©åé•¿åº¦: {analysis['compressed_length']} å­—ç¬¦")
print(f"å‹ç¼©æ¯”: {analysis['compression_ratio']:.1%}")
print(f"èŠ‚çœtokenæ•°: {analysis['savings'] // 4}")  # ç²—ç•¥ä¼°è®¡
```

**é¢„æœŸæ•ˆæœ**ï¼š
- **å‹ç¼©æ¯”**ï¼š20-40%ï¼ˆä¿ç•™æ ¸å¿ƒä¿¡æ¯çš„åŒæ—¶å¤§å¹…å‹ç¼©ï¼‰
- **ä¿¡æ¯æŸå¤±**ï¼š< 10%ï¼ˆå…³é”®å†³ç­–ä¿¡æ¯åŸºæœ¬ä¿ç•™ï¼‰
- **TokenèŠ‚çœ**ï¼š
  - åŸå§‹ï¼š20æ¡ç†ç”± Ã— 30å­— = 600å­— â‰ˆ 150 tokens
  - å‹ç¼©ï¼š5ä¸ªå…³é”®è¯ Ã— 10å­— = 50å­— â‰ˆ 13 tokens
  - **èŠ‚çœï¼š90% tokens**

---

## ğŸ”„ æŒç»­ä¼˜åŒ–ç­–ç•¥

### 1. A/Bæµ‹è¯•å¯¹æ¯”

è¿è¡Œä¸¤ç»„å®éªŒï¼š
- **ç»„A**ï¼šä½¿ç”¨åŸå§‹ç†ç”±ï¼ˆåŸºçº¿ï¼‰
- **ç»„B**ï¼šä½¿ç”¨å…³é”®è¯

å¯¹æ¯”æŒ‡æ ‡ï¼š
- ä¸­ä»‹å†³ç­–è´¨é‡ï¼ˆåˆ©æ¶¦ï¼‰
- æç¤ºè¯é•¿åº¦
- LLMæ¨ç†æ—¶é—´
- æˆæœ¬

### 2. é€æ­¥æ‰©å±•è¯è¡¨

```python
# å®šæœŸåˆ†ææœªåŒ¹é…çš„ç†ç”±
def analyze_unmatched_reasons(iteration_history):
    """æ‰¾å‡ºæœªè¢«å…³é”®è¯è¦†ç›–çš„ç†ç”±"""
    unmatched = []
    
    for record in iteration_history:
        reason = record['reason']
        keywords = extract_keywords_regex(
            reason,
            record['participation']
        )
        
        if len(keywords) == 0:
            unmatched.append(reason)
    
    return unmatched

# äººå·¥å®¡æ ¸æœªåŒ¹é…ç†ç”±ï¼Œè¡¥å……è¯è¡¨
unmatched = analyze_unmatched_reasons(history)
print(f"æœªåŒ¹é…ç‡: {len(unmatched)/len(history):.1%}")
print("æœªåŒ¹é…æ ·ä¾‹:")
for reason in unmatched[:10]:
    print(f"  - {reason}")
```

### 3. å¤šè¯­è¨€æ”¯æŒ

å¦‚æœéœ€è¦æ”¯æŒè‹±æ–‡ï¼š
```python
PARTICIPATE_KEYWORDS_EN = {
    "compensation": ["compensation", "payment", "money", "reward"],
    "benefit": ["benefit", "advantage", "value"],
    # ...
}

def extract_keywords_multilang(reason, participation, lang='zh'):
    if lang == 'zh':
        return extract_keywords_regex(reason, participation)
    elif lang == 'en':
        # ä½¿ç”¨è‹±æ–‡è¯è¡¨
        pass
```

---

## ğŸ¯ æœ€ä½³å®è·µ

### 1. è¯è¡¨è®¾è®¡åŸåˆ™

âœ… **DO**:
- åŸºäºç†è®ºæ¨¡å‹è®¾è®¡ç»´åº¦
- åŒ…å«åŒä¹‰è¯å’Œå˜ä½“
- ä½¿ç”¨å±‚çº§ç»“æ„ç»„ç»‡
- å®šæœŸæ›´æ–°å’Œæ‰©å±•

âŒ **DON'T**:
- è¯è¡¨è¿‡äºç»†ç²’åº¦ï¼ˆå¤ªå¤šç±»åˆ«ï¼‰
- é—æ¼å¸¸è§è¡¨è¾¾
- å¿½ç•¥é¢†åŸŸç‰¹å®šæœ¯è¯­

### 2. åŒ¹é…ç­–ç•¥

**ç®€å•åŒ¹é…** â†’ **æ­£åˆ™åŒ¹é…** â†’ **è¯­ä¹‰åŒ¹é…**

- **ç®€å•åŒ¹é…**ï¼šå­ä¸²åŒ…å«ï¼ˆå¿«é€Ÿï¼Œä½†å¯èƒ½è¯¯åŒ¹é…ï¼‰
- **æ­£åˆ™åŒ¹é…**ï¼šæ¨¡å¼åŒ¹é…ï¼ˆå¹³è¡¡é€Ÿåº¦å’Œå‡†ç¡®åº¦ï¼Œæ¨èï¼‰
- **è¯­ä¹‰åŒ¹é…**ï¼šä½¿ç”¨embeddingï¼ˆå‡†ç¡®ä½†æ…¢ï¼Œå¯é€‰ï¼‰

### 3. å‹ç¼©ç¨‹åº¦æ§åˆ¶

```python
# ä¿ç•™æ›´å¤šç»†èŠ‚
summary = summarize_iteration_history(
    history,
    max_keywords_per_category=10  # ä¿ç•™top10
)

# æ›´æ¿€è¿›å‹ç¼©
summary = summarize_iteration_history(
    history,
    max_keywords_per_category=3  # åªä¿ç•™top3
)
```

---

## ğŸ§ª è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œç¤ºä¾‹
python src/scenarios/scenario_c_reason_keywords.py

# è¾“å‡ºï¼š
# - å…³é”®è¯æå–ç¤ºä¾‹
# - è¿­ä»£å†å²æ€»ç»“
# - ä¸­ä»‹æç¤ºè¯
# - å‹ç¼©æ¯”åˆ†æ
```

---

## ğŸ“ æ€»ç»“

### ä¼˜åŠ¿
- âœ… **å¤§å¹…å‡å°‘æç¤ºè¯é•¿åº¦**ï¼ˆèŠ‚çœ90% tokensï¼‰
- âœ… **ä¿ç•™æ ¸å¿ƒå†³ç­–ä¿¡æ¯**ï¼ˆå…³é”®å› ç´ å…¨è¦†ç›–ï¼‰
- âœ… **é™ä½LLMæˆæœ¬**ï¼ˆtokenså‡å°‘ï¼‰
- âœ… **åŠ å¿«æ¨ç†é€Ÿåº¦**ï¼ˆè¾“å…¥æ›´çŸ­ï¼‰
- âœ… **æé«˜é²æ£’æ€§**ï¼ˆç»“æ„åŒ–è¡¨ç¤ºï¼‰

### å±€é™
- âš ï¸ **ä¿¡æ¯æŸå¤±**ï¼ˆç»†èŠ‚ä¸¢å¤±ï¼‰
- âš ï¸ **éœ€è¦ç»´æŠ¤è¯è¡¨**ï¼ˆäººå·¥æˆæœ¬ï¼‰
- âš ï¸ **å¯èƒ½è¯¯åŒ¹é…**ï¼ˆå…³é”®è¯æ­§ä¹‰ï¼‰

### å»ºè®®
- åˆæœŸä½¿ç”¨**ä¸“å®¶è®¾è®¡è¯è¡¨** + **å®šæœŸæ•°æ®é©±åŠ¨ä¼˜åŒ–**
- ç›‘æ§**æœªåŒ¹é…ç‡**ï¼Œé€æ­¥æ‰©å±•è¯è¡¨
- è¿›è¡Œ**A/Bæµ‹è¯•**éªŒè¯æ•ˆæœ
- è€ƒè™‘**æ··åˆç­–ç•¥**ï¼šé«˜é¢‘ç†ç”±ç”¨å…³é”®è¯ï¼Œä½é¢‘ç†ç”±ä¿ç•™åŸæ–‡

---

## ğŸ“š å‚è€ƒèµ„æ–™

- è®ºæ–‡ï¼šã€ŠThe Economics of Social Dataã€‹Section 2
- å®ç°ï¼š`src/scenarios/scenario_c_reason_keywords.py`
- æµ‹è¯•ï¼š`python src/scenarios/scenario_c_reason_keywords.py`
