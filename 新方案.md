### 三、场景 B：Too Much Data（推断外部性/信息外部性）——**严格对齐论文版（可落地）**

本方案严格对应论文《Too Much Data: Prices and Inefficiencies in Data Markets》主模型：高斯相关类型 + 噪声信号（方差固定为 1）+ 平台先报价格向量、用户后选分享（Stackelberg 精炼）+ Theorem 2 给出的**最小支持价格向量**闭式。

---

#### B1. 模型定位
外部性来源：用户类型相关，别人分享会“连带泄露”你的信息，使得你“自己分享”带来的**额外泄露（marginal leakage）**变小，因此平台能以更低价格购买数据，导致过度分享与潜在福利损失（含“关停更优”的区间）。

---

#### B2. 输入参数（与论文一致）
- **n**：用户数（建议 8–12，保证 \(2^n\) 可枚举）
- **\(\Sigma\succ 0\)**：类型协方差矩阵，\(\sigma_i^2=\Sigma_{ii}\)（允许不同）
- **\(v\in\mathbb R_+^n\)**：用户隐私价值（每单位泄露的损失系数）
- **噪声方差**：固定为 1（论文主模型：\(S_i=X_i+Z_i,\; Z_i\sim \mathcal N(0,1)\) 且独立）

---

#### B3. Solver 设计（严格版：枚举行动剖面 + 论文闭式）

##### B3.1 行动表示与平台可观测信息
- **行动**：\(a_i\in\{0,1\}\)，\(a_i=1\) 表示用户 \(i\) 分享 \(S_i\)
- **分享集合**：\(S(a)=\{j:a_j=1\}\)
- **平台观测**：\(S_a=(S_j)_{j\in S(a)}\)

##### B3.2 泄露信息 \(I_i(a)\)（论文定义：MSE reduction）
对任意行动剖面 \(a\)，定义：
\[
I_i(a)=\sigma_i^2-\operatorname{Var}(X_i\mid S_a).
\]
在论文设定（噪声方差=1）下，给定集合 \(S=S(a)\)：
- 若 \(S=\emptyset\)，则 \(I_i(a)=0\)
- 否则
\[
I_i(a)=\Sigma_{iS}\,(\Sigma_{SS}+I)^{-1}\,\Sigma_{Si}.
\]
**实现要点**：用 Cholesky/solve 计算 \((\Sigma_{SS}+I)^{-1}b\)，避免显式求逆。

##### B3.3 外部性泄露 \(I_i^0(a)\)
对分享者 \(i\in S\)：令 \(S_{-i}=S\setminus\{i\}\)，定义
\[
I_i^0(a)\equiv I_i(a_i=0,a_{-i})=\Sigma_{iS_{-i}}(\Sigma_{S_{-i}S_{-i}}+I)^{-1}\Sigma_{S_{-i}i}.
\]
对不分享者 \(i\notin S\)，可直接令 \(I_i^0(a)=I_i(a)\)（仅用于统一字段，价格计算不需要）。

##### B3.4 最小支持价格向量 \(p^a\)（必须用 Theorem 2 闭式）
对分享者 \(i\in S(a)\)：
\[
p_i^a = v_i\cdot \frac{(\sigma_i^2-I_i^{0}(a))^2}{(\sigma_i^2+1)-I_i^{0}(a)}.
\]
对不分享者 \(a_i=0\)：\(p_i^a=0\)（不分享者价格在论文中无需定义，落库实现取 0）。

##### B3.5 平台收益与 Stackelberg 精炼均衡
平台效用：
\[
U(a,p)=\sum_{i=1}^n I_i(a)-\sum_{i:a_i=1}p_i.
\]
平台诱导行动剖面 \(a\) 时会把价格压到最小支持价 \(p^a\)，因此：
\[
U^a \equiv U(a,p^a)=\sum_{i=1}^n I_i(a)-\sum_{i\in S(a)}p_i^a.
\]
**均衡（平台精炼）**：
\[
a^E \in \arg\max_{a\in\{0,1\}^n} U^a,\qquad p^E=p^{a^E}.
\]

##### B3.6 社会福利与 first-best（闭式，避免受价格细节影响）
由于支付是转移项，总福利可写成论文隐含闭式：
\[
W(a)=U(a,p)+\sum_i u_i(a,p)=\sum_{i=1}^n (1-v_i)\,I_i(a).
\]
因此 first-best：
\[
a^{FB}\in\arg\max_{a\in\{0,1\}^n}\sum_i (1-v_i)I_i(a).
\]

##### B3.7 关停（shutdown）
关停对应 \(a=\mathbf 0\Rightarrow I_i(\mathbf 0)=0\Rightarrow W(\mathbf 0)=0\)。

---

#### B4. 输出数值（gt_numeric）
- **eq_action_vector / eq_mask**：\(a^E\)
- **eq_share_set**：\(S(a^E)\)
- **eq_prices**：\(p^E\)
- **eq_I_vector**：\((I_i(a^E))_{i=1}^n\)
- **eq_U**：\(U^E=U(a^E,p^E)\)
- **eq_W**：\(W(a^E)\)
- **fb_action_vector / fb_mask**：\(a^{FB}\)
- **fb_W**
- **shutdown_W**：0
- **mechanism_evidence（建议）**：对每个 \(i\in S(a^E)\) 记录 \((\sigma_i^2,\ I_i^0(a^E),\ p_i^E,\ I_i(a^E))\)，用于解释“外部性压低价格”。

---

#### B5. 抽象标签（gt_labels）
- **eq_share_rate_bucket**：\(|S(a^E)|/n\) 分桶 low/med/high
- **full_sharing / no_sharing**：是否 \(a^E=\mathbf 1/\mathbf 0\)
- **over_sharing**：\(1\{|S(a^E)|>|S(a^{FB})|\}\)
- **shutdown_better**：\(1\{W(a^E)<0\}\)（等价于 \(W(\mathbf 0)=0>W(a^E)\)）
- **welfare_gap_bucket**：bucket\((W(a^{FB})-W(a^E))\)
- **price_depression_metric（机制证据标签，建议）**：例如均衡分享者的平均 \(\Delta I_i\)（或等价闭式项）相对“更少人分享”情形显著更小。

---

#### B6. 建议 LLM 题目字段
- **结构题**：分享率桶 / 是否全分享 / 是否零分享
- **效率题**：是否过度分享、关停是否更优、福利差距桶
- **机制解释题要点**：不分享也会泄露（推断外部性）；外部性增大使额外泄露变小，价格被压低，从而诱导过度分享。

---

#### 附：回归测试建议（可选，但强烈建议）
- **公式级单测**：随机 \(\Sigma\)、随机 \(a\)，验证 \(I_i(a)\)、\(I_i^0(a)\)、\(p_i^a\) 与闭式一致。
- **两用户黄金例子**：\(\Sigma=\begin{pmatrix}1&\rho\\ \rho&1\end{pmatrix}\)、\(v_1=v_2=1\)，应复现论文的全分享均衡与价格变化规律。
- **机制级网格**：扫 \(\rho\)、\(v\) 形成“\(W(a^E)<0\)”区域，检查与论文描述的单调性一致。