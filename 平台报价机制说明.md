# å¹³å°æŠ¥ä»·æœºåˆ¶è¯¦è§£

**æ–‡æ¡£æ—¥æœŸ**: 2026-01-15  
**é€‚ç”¨ç‰ˆæœ¬**: é™æ€åšå¼ˆé‡æ„ç‰ˆæœ¬  
**ä»£ç æ–‡ä»¶**: `src/evaluators/evaluate_scenario_b.py`, `src/scenarios/scenario_b_too_much_data.py`

---

## ä¸€ã€æ ¸å¿ƒæœºåˆ¶æ¦‚è§ˆ

åœºæ™¯Bæ”¯æŒ**ä¸¤ç§å¹³å°æŠ¥ä»·æ¨¡å¼**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         å¹³å°æŠ¥ä»·æœºåˆ¶ï¼ˆäºŒé€‰ä¸€ï¼‰                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 1ï¸âƒ£ ç†è®ºæ±‚è§£å™¨æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰                        â”‚
â”‚    - use_theory_platform = True                â”‚
â”‚    - ä½¿ç”¨TMDè®ºæ–‡çš„Stackelbergæ±‚è§£å™¨             â”‚
â”‚    - ä¸ªæ€§åŒ–ä»·æ ¼ï¼Œåˆ©æ¶¦æœ€ä¼˜                        â”‚
â”‚    - Ground TruthåŸºå‡†                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 2ï¸âƒ£ LLMæŠ¥ä»·æ¨¡å¼ï¼ˆå®éªŒæ€§ï¼‰                         â”‚
â”‚    - use_theory_platform = False               â”‚
â”‚    - å¹³å°ç”±LLMå†³ç­–ä»·æ ¼                           â”‚
â”‚    - å½“å‰ä»…æ”¯æŒç»Ÿä¸€ä»·æ ¼                          â”‚
â”‚    - ç”¨äºå¯¹æ¯”LLMç†è§£èƒ½åŠ›                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äºŒã€æ¨¡å¼1ï¼šç†è®ºæ±‚è§£å™¨æŠ¥ä»·ï¼ˆé»˜è®¤ï¼‰

### 2.1 å·¥ä½œæµç¨‹

**L551-567ï¼ˆ`evaluate_scenario_b.py`ï¼‰**ï¼š

```python
if self.use_theory_platform:  # é»˜è®¤True
    # 1. è°ƒç”¨TMDç†è®ºæ±‚è§£å™¨
    sol = solve_stackelberg_personalized(self.params)
    
    # 2. è·å–ä¸ªæ€§åŒ–ä»·æ ¼å‘é‡
    prices = sol["eq_prices"]  # [p_0, p_1, ..., p_{n-1}]
    
    # 3. è·å–ç†è®ºæœ€ä¼˜åˆ†äº«é›†åˆ
    theory_share_set = sol["eq_share_set"]
    
    # 4. è®°å½•è¯Šæ–­ä¿¡æ¯
    platform_info = {
        "mode": "theory_solver",
        "prices": prices,
        "theory_share_set": theory_share_set,
        "solver_mode": sol["solver_mode"]  # "exact" æˆ– "local_search"
    }
```

### 2.2 ç†è®ºæ±‚è§£å™¨ç®—æ³•

**æ ¸å¿ƒå‡½æ•°**ï¼š`solve_stackelberg_personalized()` ï¼ˆ`scenario_b_too_much_data.py` L447-544ï¼‰

#### **è¾“å…¥**
```python
params: ScenarioBParams  # åŒ…å« n, v, Sigma, sigma_noise_sq, rho
exact_n_limit: int = 22  # æšä¸¾é˜ˆå€¼
epsilon: float = 1e-6    # æ”¯æ’‘ä»·æ ¼æ‰°åŠ¨
```

#### **ç®—æ³•æ­¥éª¤**

**é˜¶æ®µ1ï¼šæšä¸¾å€™é€‰é›†åˆ**

å¯¹äºæ¯ä¸ªå¯èƒ½çš„åˆ†äº«é›†åˆ S âŠ† {0,1,...,n-1}ï¼š

```python
# å°è§„æ¨¡ï¼ˆn â‰¤ 22ï¼‰ï¼šå®Œå…¨æšä¸¾
if n <= exact_n_limit:
    for S in all_2^n_subsets:
        profit, prices = evaluate_set(S)
        if profit > best_profit:
            best_S = S
            best_prices = prices
```

```python
# å¤§è§„æ¨¡ï¼ˆn > 22ï¼‰ï¼šå±€éƒ¨æœç´¢
else:
    for restart in range(10):  # å¤šæ¬¡é‡å¯
        S_current = random_init()
        for iteration in range(200):
            # å°è¯•å•ç‚¹ç¿»è½¬ï¼ˆaddæˆ–removeä¸€ä¸ªç”¨æˆ·ï¼‰
            neighbors = generate_neighbors(S_current)
            S_current = best_neighbor
        if profit(S_current) > best_profit:
            best_S = S_current
```

**é˜¶æ®µ2ï¼šè®¡ç®—æ”¯æ’‘ä»·æ ¼**

å¯¹äºç»™å®šçš„Sï¼Œè®¡ç®—ä½¿Sæˆä¸ºçº³ä»€å‡è¡¡çš„**æœ€å°æ”¯æ’‘ä»·æ ¼**ï¼š

```python
def _supporting_prices_for_set(params, S):
    """L385-404"""
    prices = [0.0] * n
    
    # è®¡ç®—Sä¸‹çš„æ³„éœ²
    leak = [I_i(S) for i in range(n)]
    
    # å¯¹æ¯ä¸ªåˆ†äº«è€…iâˆˆS
    for i in S:
        # è®¡ç®—è¾¹é™…æ³„éœ²ï¼šÎ”I_i = I_i(S) - I_i(S\{i})
        S_wo = S - {i}
        leak_i_wo = I_i(S_wo)
        marginal = leak[i] - leak_i_wo
        
        # è®¾å®šæ”¯æ’‘ä»·æ ¼ï¼šp_i = v_i Ã— Î”I_i + Îµ
        prices[i] = v[i] * marginal + epsilon
    
    return prices
```

**æ¿€åŠ±ç›¸å®¹æ¡ä»¶**ï¼š
```
å¯¹äº iâˆˆSï¼š
  u_i(åˆ†äº«) = p_i - v_i Ã— I_i(S)
            = v_i Ã— Î”I_i + Îµ - v_i Ã— I_i(S)
            = -v_i Ã— I_i(S\{i}) + Îµ
            > -v_i Ã— I_i(S\{i})
            = u_i(ä¸åˆ†äº«)  âœ…

å¯¹äº jâˆ‰Sï¼ˆp_j = 0ï¼‰ï¼š
  u_j(ä¸åˆ†äº«) = -v_j Ã— I_j(S)
              â‰¥ 0 - v_j Ã— I_j(Sâˆª{j})
              = u_j(åˆ†äº«)  âœ…
```

**é˜¶æ®µ3ï¼šè®¡ç®—å¹³å°åˆ©æ¶¦**

```python
def _profit_for_set_under_supporting_prices(params, S):
    """L407-444"""
    prices = _supporting_prices_for_set(params, S)
    
    # å¹³å°åˆ©æ¶¦
    profit = Î£_i I_i(S) - Î£_{iâˆˆS} prices[i]
    
    # å‡è¡¡è£•åº¦å®¡è®¡ï¼ˆéªŒè¯NEæ¡ä»¶ï¼‰
    margins_in = [p_i - v_i Ã— Î”I_i for i in S]    # åº”â‰¥Îµ
    margins_out = [0 - v_j Ã— marginal_j for jâˆ‰S] # åº”â‰¤0
    
    return profit, prices, diagnostics
```

**é˜¶æ®µ4ï¼šé€‰æ‹©æœ€ä¼˜é›†åˆ**

```python
S* = argmax_{SâŠ†N} [Î£ I_i(S) - Î£_{iâˆˆS} p_i^S]
```

---

### 2.3 ç†è®ºä¿è¯

**å®šç†**ï¼šæ±‚è§£å™¨è¾“å‡ºæ»¡è¶³Stackelbergå‡è¡¡ï¼š

1. **å­åšå¼ˆå®Œç¾**ï¼šåœ¨S*å’Œp*ä¸‹ï¼Œç”¨æˆ·å†³ç­–æ„æˆçº³ä»€å‡è¡¡
   ```
   å¯¹æ‰€æœ‰i: a_i* âˆˆ argmax u_i(a_i, a_{-i}*)
   ```

2. **å¹³å°æœ€ä¼˜**ï¼šS*æ˜¯å¹³å°åˆ©æ¶¦æœ€å¤§çš„é›†åˆ
   ```
   Î (S*) â‰¥ Î (S)  å¯¹æ‰€æœ‰ S âŠ† N
   ```

3. **æ¿€åŠ±ç›¸å®¹**ï¼šä»·æ ¼ç²¾ç¡®è¦†ç›–è¾¹é™…éšç§æŸå¤±ï¼ˆåŠ Îµæ‰°åŠ¨ï¼‰
   ```
   p_i = v_i Ã— Î”I_i + Îµ
   ```

---

### 2.4 è¾“å‡ºç¤ºä¾‹

```json
{
  "eq_share_set": [0, 2, 4, 7],
  "eq_prices": [0.12, 0.0, 0.18, 0.0, 0.21, 0.0, 0.0, 0.15, 0.0, 0.0],
  "eq_profit": 0.847,
  "eq_W": 0.523,
  "eq_total_leakage": 2.134,
  "solver_mode": "exact",
  "diagnostics": {
    "min_margin_in": 1.0e-06,
    "max_margin_out": -0.0023
  }
}
```

**è§£è¯»**ï¼š
- ç†è®ºæœ€ä¼˜ï¼š4ä¸ªç”¨æˆ·åˆ†äº«ï¼ˆç”¨æˆ·0,2,4,7ï¼‰
- ä¸ªæ€§åŒ–ä»·æ ¼ï¼šä»…åˆ†äº«è€…æœ‰æ­£ä»·æ ¼
- å‡è¡¡è£•åº¦ï¼š
  - `min_margin_in = Îµ`ï¼šåˆ†äº«è€…æ°å¥½æ— å·®å¼‚ï¼ˆåŠ Îµåæ„¿æ„åˆ†äº«ï¼‰
  - `max_margin_out < 0`ï¼šéåˆ†äº«è€…æ— åç¦»æ¿€åŠ±

---

## ä¸‰ã€æ¨¡å¼2ï¼šLLMæŠ¥ä»·ï¼ˆå®éªŒæ€§ï¼‰

### 3.1 å·¥ä½œæµç¨‹

**L568-586ï¼ˆ`evaluate_scenario_b.py`ï¼‰**ï¼š

```python
else:  # use_theory_platform = False
    # 1. æŸ¥è¯¢LLMç”Ÿæˆä»·æ ¼
    platform_pricing = self.query_platform_pricing(
        pricing_mode="uniform",
        num_trials=1
    )
    
    # 2. è·å–ç»Ÿä¸€ä»·æ ¼
    uniform_price = platform_pricing["uniform_price"]
    prices = [uniform_price] * n
    
    # 3. è®°å½•LLMä¿¡å¿µ
    platform_info = {
        "mode": "llm_pricing",
        "uniform_price": uniform_price,
        "belief_share_rate": platform_pricing["belief_share_rate"],
        "reason": platform_pricing["reason"]
    }
```

### 3.2 LLM Promptè®¾è®¡

**Promptç»“æ„**ï¼ˆ`build_platform_pricing_prompt()` L193-268ï¼‰ï¼š

```markdown
ä½ æ˜¯æ•°æ®äº¤æ˜“å¹³å°ï¼Œéœ€è¦è®¾å®šä»·æ ¼pä»¥æ¿€åŠ±ç”¨æˆ·åˆ†äº«æ•°æ®ã€‚

## å¸‚åœºä¿¡æ¯
- æ€»ç”¨æˆ·æ•°: n = 10
- æ•°æ®ç›¸å…³æ€§: Ï = 0.6ï¼ˆé«˜ç›¸å…³æ€§ï¼‰
- éšç§åå¥½åˆ†å¸ƒ: v ~ Uniform[0.3, 1.2]
- ç›¸å…³æ€§ç»“æ„æ‘˜è¦:
  * ç”¨æˆ·0å¹³å‡ç›¸å…³: 0.58ï¼ˆå¼ºé‚»å±…3ä¸ªï¼‰
  * ç”¨æˆ·1å¹³å‡ç›¸å…³: 0.61ï¼ˆå¼ºé‚»å±…4ä¸ªï¼‰
  * ...

## ä½ çš„åˆ©æ¶¦å‡½æ•°
Î (S) = Î± Ã— Î£_i I_i(S) - Î£_{iâˆˆS} p_i

- æ”¶å…¥ï¼šä»æ‰€æœ‰ç”¨æˆ·è·å¾—ä¿¡æ¯ä»·å€¼ï¼ˆåŒ…æ‹¬ä¸åˆ†äº«è€…ï¼‰
- æˆæœ¬ï¼šä»…æ”¯ä»˜ç»™åˆ†äº«è€…

## æ ¸å¿ƒæœºåˆ¶
1. **æ¨æ–­å¤–éƒ¨æ€§**ï¼šå³ä½¿ç”¨æˆ·ä¸åˆ†äº«ï¼Œä¹Ÿèƒ½é€šè¿‡å…¶ä»–äººæ¨æ–­
2. **æ¬¡æ¨¡æ€§**ï¼šåˆ†äº«äººè¶Šå¤šï¼Œæ–°å¢ä¸€äººçš„è¾¹é™…ä»·å€¼è¶Šä½
3. **æ¿€åŠ±ç›¸å®¹**ï¼šä»·æ ¼éœ€è¦†ç›–ç”¨æˆ·çš„è¾¹é™…éšç§æŸå¤±

## å†³ç­–æ¡†æ¶
1. æ¨æµ‹ç”¨æˆ·çš„åˆ†äº«æ„æ„¿ï¼ˆvä½â†’æ„¿æ„ï¼Œvé«˜â†’ä¸æ„¿æ„ï¼‰
2. åŸºäºå…ˆéªŒF_vé¢„ä¼°åˆ†äº«ç‡
3. æƒè¡¡ï¼šä»·æ ¼é«˜â†’å¸å¼•æ›´å¤šäººä½†æˆæœ¬é«˜ï¼›ä»·æ ¼ä½â†’æˆæœ¬ä½ä½†äººå°‘
4. è€ƒè™‘æ¬¡æ¨¡æ€§ï¼šäººå¤šæ—¶è¾¹é™…ä»·å€¼é€’å‡

## è¾“å‡ºæ ¼å¼ï¼ˆJSONï¼‰
{
  "uniform_price": æµ®ç‚¹æ•°ï¼ˆå»ºè®®ä»·æ ¼ï¼‰,
  "belief_share_rate": 0-1ä¹‹é—´ï¼ˆä½ é¢„æœŸçš„åˆ†äº«ç‡ï¼‰,
  "reason": "ç®€è¦è¯´æ˜å®šä»·é€»è¾‘ï¼ˆâ‰¤150å­—ï¼‰"
}
```

**å…³é”®ä¿¡æ¯**ï¼š
1. âœ… F_våˆ†å¸ƒï¼ˆè®©LLMæ¨æµ‹è¡Œä¸ºï¼‰
2. âœ… ç›¸å…³æ€§æ‘˜è¦ï¼ˆå‹ç¼©çš„Sigmaä¿¡æ¯ï¼‰
3. âœ… åˆ©æ¶¦å‡½æ•°ï¼ˆæ˜ç¡®ç›®æ ‡ï¼‰
4. âœ… æ¬¡æ¨¡æ€§æç¤ºï¼ˆç»æµç›´è§‰ï¼‰
5. âœ… è¦æ±‚è¾“å‡ºä¿¡å¿µï¼ˆæ•æ‰é¢„æœŸï¼‰

---

### 3.3 æŸ¥è¯¢é€»è¾‘

**`query_platform_pricing()` L354-426**ï¼š

```python
def query_platform_pricing(self, pricing_mode, num_trials):
    results = []
    
    for trial in range(num_trials):
        # 1. è°ƒç”¨LLM
        response = self.llm_client.generate_json([
            {"role": "system", "content": build_system_prompt_platform()},
            {"role": "user", "content": build_platform_pricing_prompt()}
        ])
        
        # 2. è§£æè¾“å‡º
        price = float(response.get("uniform_price", 0.0))
        if price < 0:
            price = 0.0
        
        result = {
            "uniform_price": price,
            "belief_share_rate": float(response.get("belief_share_rate", 0.5)),
            "reason": response.get("reason", "")
        }
        results.append(result)
    
    # 3. èšåˆå¤šæ¬¡è¯•éªŒï¼ˆå¹³å‡ï¼‰
    avg_price = np.mean([r["uniform_price"] for r in results])
    return {"uniform_price": avg_price, ...}
```

**é²æ£’æ€§è®¾è®¡**ï¼š
- æ”¯æŒå¤šæ¬¡è¯•éªŒï¼ˆ`num_trials`ï¼‰ï¼Œå–å¹³å‡
- é‡è¯•æœºåˆ¶ï¼ˆ`max_retries=1`ï¼‰
- é»˜è®¤å€¼ï¼ˆå¤±è´¥æ—¶p=0.5ï¼‰

---

### 3.4 å½“å‰é™åˆ¶

âš ï¸ **ä»…æ”¯æŒç»Ÿä¸€ä»·æ ¼**ï¼š
```python
prices = [uniform_price] * n  # æ‰€æœ‰ç”¨æˆ·åŒä»·
```

âš ï¸ **ä¸ªæ€§åŒ–ä»·æ ¼æœªå®ç°**ï¼š
```python
else:  # pricing_mode == "personalized"
    raise ValueError("LLMå¹³å°ä¸ªæ€§åŒ–å®šä»·æœªå®ç°")
```

**åŸå› **ï¼š
1. ä¸ªæ€§åŒ–å®šä»·éœ€è¦LLMè¾“å‡ºnç»´å‘é‡ï¼ˆå¤æ‚ï¼‰
2. LLMéš¾ä»¥ç†è§£"æ¯ä¸ªç”¨æˆ·ä¸åŒä»·æ ¼"çš„æœºåˆ¶
3. ç†è®ºæ±‚è§£å™¨å·²æä¾›ä¸ªæ€§åŒ–åŸºå‡†

---

## å››ã€ä¸¤ç§æ¨¡å¼çš„å¯¹æ¯”

| ç»´åº¦ | ç†è®ºæ±‚è§£å™¨ | LLMæŠ¥ä»· |
|------|-----------|---------|
| **å®šä»·æ–¹å¼** | ä¸ªæ€§åŒ–ï¼ˆp_iæ ¹æ®v_iå’ŒÎ”I_iï¼‰ | ç»Ÿä¸€ä»·æ ¼ï¼ˆæ‰€æœ‰äººåŒä»·ï¼‰ |
| **ç®—æ³•** | æšä¸¾/å±€éƒ¨æœç´¢ | LLMç”Ÿæˆ |
| **ç†è®ºä¿è¯** | âœ… Stackelbergå‡è¡¡ | âŒ æ— ä¿è¯ |
| **åˆ©æ¶¦** | å…¨å±€æœ€ä¼˜ | å¯èƒ½æ¬¡ä¼˜ |
| **è®¡ç®—æˆæœ¬** | O(2^n)æˆ–O(nÂ²) | O(1)æ¬¡LLMè°ƒç”¨ |
| **å¯è§£é‡Šæ€§** | å®Œå…¨é€æ˜ | é»‘ç›’ |
| **ç”¨é€”** | Ground TruthåŸºå‡† | è¯„ä¼°LLMç†è§£èƒ½åŠ› |
| **è¾“å…¥ä¿¡æ¯** | å®Œæ•´params | å‹ç¼©çš„F_vå’ŒSigmaæ‘˜è¦ |
| **ä¿¡æ¯ç»“æ„** | å®Œå…¨ä¿¡æ¯ï¼ˆçŸ¥é“æ‰€æœ‰v_iï¼‰ | ä¸å®Œå…¨ä¿¡æ¯ï¼ˆåªçŸ¥é“F_vï¼‰ |

---

## äº”ã€å¹³å°æŠ¥ä»·çš„ç»æµå­¦åŸç†

### 5.1 æ”¯æ’‘ä»·æ ¼çš„ç›´è§‰

**é—®é¢˜**ï¼šå¹³å°å¦‚ä½•ç¡®å®šp_iè®©ç”¨æˆ·iæ„¿æ„åˆ†äº«ï¼Ÿ

**ç­”æ¡ˆ**ï¼šè¡¥å¿å…¶**è¾¹é™…éšç§æŸå¤±**

```
ç”¨æˆ·içš„æƒè¡¡ï¼š
  åˆ†äº«ï¼šå¾—p_iï¼Œå¤±v_i Ã— I_i(S)
  ä¸åˆ†äº«ï¼šå¾—0ï¼Œå¤±v_i Ã— I_i(S\{i})

è¾¹é™…æŸå¤±ï¼š
  v_i Ã— [I_i(S) - I_i(S\{i})] = v_i Ã— Î”I_i

æ”¯æ’‘ä»·æ ¼ï¼š
  p_i = v_i Ã— Î”I_i + Îµ
```

**ä¾‹å­**ï¼ˆn=10, Ï=0.6ï¼‰ï¼š
```
ç”¨æˆ·0: v_0 = 0.5, Î”I_0 = 0.24 â†’ p_0 = 0.12
ç”¨æˆ·1: v_1 = 0.8, Î”I_1 = 0.18 â†’ p_1 = 0.14
ç”¨æˆ·2: v_2 = 0.3, Î”I_2 = 0.30 â†’ p_2 = 0.09
```

**è§‚å¯Ÿ**ï¼š
- vé«˜+Î”Ié«˜ â†’ pé«˜ï¼ˆéšç§æ•æ„Ÿ+è´¡çŒ®å¤§ï¼‰
- vä½+Î”Iä½ â†’ pä½ï¼ˆéšç§ä¸æ•æ„Ÿ+è´¡çŒ®å°ï¼‰

---

### 5.2 æ¬¡æ¨¡æ€§çš„å½±å“

**æ¬¡æ¨¡æ€§å®šä¹‰**ï¼š
```
Î”I_i(j | Sâ‚) â‰¥ Î”I_i(j | Sâ‚‚)  å½“ Sâ‚ âŠ† Sâ‚‚
```

**å«ä¹‰**ï¼šè¾¹é™…ä¿¡æ¯ä»·å€¼é€’å‡

**å¯¹å¹³å°çš„å½±å“**ï¼š
```
å½“Så˜å¤§æ—¶ï¼š
  - æ–°å¢ç”¨æˆ·jçš„è¾¹é™…è´¡çŒ®Î”I_jå˜å°
  - å¹³å°åªéœ€æ”¯ä»˜æ›´ä½çš„ä»·æ ¼p_j
  - å¹³å°å€¾å‘äº"å¤šæ”¶äººï¼Œä½†å‹ä½ä»·"
```

**å¯¹ç”¨æˆ·çš„å½±å“**ï¼š
```
å½“Så˜å¤§æ—¶ï¼š
  - ç”¨æˆ·içš„è¾¹é™…æ³„éœ²Î”I_iå˜å°
  - ç”¨æˆ·iæ›´æ„¿æ„æ¥å—ä½ä»·ï¼ˆåæ­£å·²æ³„éœ²å¾ˆå¤šï¼‰
```

---

### 5.3 æ¨æ–­å¤–éƒ¨æ€§çš„ä½œç”¨

**æœºåˆ¶**ï¼š
```
âˆ‚I_i(S) / âˆ‚a_j â‰  0  ï¼ˆå³ä½¿ i â‰  jï¼‰
```

**å¯¹å¹³å°çš„å½±å“**ï¼š
```
å¹³å°æ”¶å…¥ = Î£_i I_i(S)
          ^^^^^^^^^^^^^^
          åŒ…æ‹¬ä¸åˆ†äº«è€…ï¼

ç¤ºä¾‹ï¼ˆn=3ï¼ŒS={0,1}ï¼‰ï¼š
  I_0(S) = 0.35  âœ“ ç”¨æˆ·0åˆ†äº«äº†
  I_1(S) = 0.40  âœ“ ç”¨æˆ·1åˆ†äº«äº†
  I_2(S) = 0.28  âœ“ ç”¨æˆ·2æ²¡åˆ†äº«ä¹Ÿè¢«æ¨æ–­ï¼
  
  æ€»æ”¶å…¥ = 1.03 > p_0 + p_1 = 0.35
  ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  å¹³å°ä»å¤–éƒ¨æ€§ä¸­è·åˆ©
```

**å¯¹ç”¨æˆ·çš„å½±å“**ï¼š
```
å³ä½¿ä¸åˆ†äº«ä¹Ÿä¼šæ³„éœ²ï¼š
  u_i(ä¸åˆ†äº«) = -v_i Ã— I_i(S\{i}) < 0
                         ^^^^^^^^^^
                         S\{i}å¯èƒ½å¾ˆå¤§ï¼
```

---

## å…­ã€ä»£ç ä¸­çš„å…³é”®ä½ç½®

### 6.1 ç†è®ºæ±‚è§£å™¨

| åŠŸèƒ½ | å‡½æ•° | ä½ç½® |
|------|------|------|
| ä¸»å…¥å£ | `solve_stackelberg_personalized()` | L447 |
| æ”¯æ’‘ä»·æ ¼ | `_supporting_prices_for_set()` | L385 |
| åˆ©æ¶¦è®¡ç®— | `_profit_for_set_under_supporting_prices()` | L407 |
| æšä¸¾æœç´¢ | `solve_stackelberg_personalized()` | L469-495 |
| å±€éƒ¨æœç´¢ | `solve_stackelberg_personalized()` | L497-544 |
| åéªŒåæ–¹å·® | `compute_posterior_covariance()` | L87 |
| æ³„éœ²è®¡ç®— | `calculate_leakage()` | L192 |

### 6.2 LLMæŠ¥ä»·

| åŠŸèƒ½ | å‡½æ•° | ä½ç½® |
|------|------|------|
| æŸ¥è¯¢æ–¹æ³• | `query_platform_pricing()` | L354 |
| Promptç”Ÿæˆ | `build_platform_pricing_prompt()` | L193 |
| System Prompt | `build_system_prompt_platform()` | L166 |
| ç›¸å…³æ€§æ‘˜è¦ | `_compute_correlation_summaries()` | L141 |

### 6.3 è¯„ä¼°å™¨è°ƒç”¨

| åŠŸèƒ½ | ä½ç½® | è¯´æ˜ |
|------|------|------|
| æ¨¡å¼é€‰æ‹© | L551-586 | if-elseåˆ†æ”¯ |
| å¹³å°ä¿¡æ¯è®°å½• | L562-567, L578-584 | platform_infoå­—å…¸ |
| ç»“æœæ„é€  | L637-652 | results["platform"] |

---

## ä¸ƒã€å®éªŒå»ºè®®

### 7.1 æµ‹è¯•ç†è®ºæ±‚è§£å™¨

```python
from src.scenarios import generate_instance, solve_stackelberg_personalized

# ç”Ÿæˆå®ä¾‹
params = generate_instance(n=10, rho=0.6, seed=42)

# æ±‚è§£
sol = solve_stackelberg_personalized(params)

print(f"æœ€ä¼˜é›†åˆ: {sol['eq_share_set']}")
print(f"ä»·æ ¼èŒƒå›´: [{min(sol['eq_prices']):.3f}, {max(sol['eq_prices']):.3f}]")
print(f"å¹³å°åˆ©æ¶¦: {sol['eq_profit']:.3f}")
```

### 7.2 æµ‹è¯•LLMæŠ¥ä»·

```python
from src.evaluators import ScenarioBEvaluator, create_llm_client

llm_client = create_llm_client("gpt-4o-mini")
evaluator = ScenarioBEvaluator(llm_client, use_theory_platform=False)

results = evaluator.simulate_static_game(pricing_mode="uniform")

print(f"LLMå®šä»·: {results['platform']['uniform_price']:.3f}")
print(f"LLMé¢„æœŸ: {results['platform']['belief_share_rate']:.2%}")
print(f"å®é™…åˆ†äº«ç‡: {results['belief_consistency']['actual_share_rate']:.2%}")
```

### 7.3 å¯¹æ¯”ä¸¤ç§æ¨¡å¼

```python
# æ¨¡å¼1ï¼šç†è®ºåŸºå‡†
evaluator_theory = ScenarioBEvaluator(llm_client, use_theory_platform=True)
results_theory = evaluator_theory.simulate_static_game()

# æ¨¡å¼2ï¼šLLMæŠ¥ä»·
evaluator_llm = ScenarioBEvaluator(llm_client, use_theory_platform=False)
results_llm = evaluator_llm.simulate_static_game()

# æ¯”è¾ƒåˆ©æ¶¦
print(f"ç†è®ºåˆ©æ¶¦: {results_theory['llm_outcome']['profit']:.3f}")
print(f"LLMåˆ©æ¶¦: {results_llm['llm_outcome']['profit']:.3f}")
```

---

## å…«ã€æ€»ç»“

### âœ… ç†è®ºæ±‚è§£å™¨ï¼ˆé»˜è®¤ï¼‰

**ä¼˜ç‚¹**ï¼š
- ç†è®ºæœ€ä¼˜ï¼ˆStackelbergå‡è¡¡ï¼‰
- ä¸ªæ€§åŒ–ä»·æ ¼ï¼ˆæ¿€åŠ±ç›¸å®¹ï¼‰
- å¯ç²¾ç¡®è®¡ç®—ï¼ˆnâ‰¤22å®Œå…¨æšä¸¾ï¼‰
- æä¾›Ground TruthåŸºå‡†

**é€‚ç”¨åœºæ™¯**ï¼š
- è¯„ä¼°LLMç”¨æˆ·å†³ç­–ï¼ˆå›ºå®šä»·æ ¼ä¸‹ï¼‰
- ç”Ÿæˆç†è®ºåŸºå‡†æ•°æ®
- éªŒè¯ç»æµæ¨¡å‹

**æ ¸å¿ƒç®—æ³•**ï¼š
```
1. æšä¸¾/æœç´¢æ‰€æœ‰S
2. å¯¹æ¯ä¸ªSè®¡ç®—æ”¯æ’‘ä»·æ ¼p^S = [v_i Ã— Î”I_i + Îµ]_{iâˆˆS}
3. è®¡ç®—åˆ©æ¶¦Î (S) = Î£ I_i(S) - Î£_{iâˆˆS} p_i^S
4. é€‰æ‹©S* = argmax Î (S)
```

---

### âš ï¸ LLMæŠ¥ä»·ï¼ˆå®éªŒæ€§ï¼‰

**ä¼˜ç‚¹**ï¼š
- æµ‹è¯•LLMç†è§£ç»æµæœºåˆ¶çš„èƒ½åŠ›
- å¯å¯¹æ¯”"ç†æ€§å¹³å° vs LLMå¹³å°"
- ç ”ç©¶ä¿¡å¿µå½¢æˆè´¨é‡

**é™åˆ¶**ï¼š
- ä»…ç»Ÿä¸€ä»·æ ¼ï¼ˆä¸ªæ€§åŒ–æœªå®ç°ï¼‰
- æ— ç†è®ºä¿è¯ï¼ˆå¯èƒ½æ¬¡ä¼˜ï¼‰
- ä¾èµ–Promptè´¨é‡

**é€‚ç”¨åœºæ™¯**ï¼š
- ç ”ç©¶LLMçš„å®šä»·ç­–ç•¥
- è¯„ä¼°LLMå¯¹æ¬¡æ¨¡æ€§çš„ç†è§£
- å¯¹æ¯”å®éªŒ

---

### ğŸ¯ è®¾è®¡å“²å­¦

**ä¸ºä»€ä¹ˆé»˜è®¤ç”¨ç†è®ºæ±‚è§£å™¨ï¼Ÿ**

1. **ç†è®ºå¯¹é½**ï¼šTMDè®ºæ–‡å‡è®¾å¹³å°å®Œå…¨ç†æ€§
2. **æ§åˆ¶å˜é‡**ï¼šå›ºå®šä»·æ ¼ï¼Œä»…è¯„ä¼°ç”¨æˆ·LLM
3. **åŸºå‡†è´¨é‡**ï¼šæä¾›å¯é çš„Ground Truth
4. **å¯è§£é‡Šæ€§**ï¼šä»·æ ¼æ¥æºé€æ˜ï¼ˆp_i = v_i Ã— Î”I_iï¼‰

**ä½•æ—¶ä½¿ç”¨LLMæŠ¥ä»·ï¼Ÿ**

1. ç ”ç©¶"LLMå¹³å° vs ç†æ€§ç”¨æˆ·"
2. æµ‹è¯•ç«¯åˆ°ç«¯çš„LLMåšå¼ˆèƒ½åŠ›
3. æ¢ç´¢LLMçš„å®šä»·ç­–ç•¥å¤šæ ·æ€§

---

**å…³é”®æ´å¯Ÿ**ï¼š

1. å¹³å°æŠ¥ä»·çš„æ ¸å¿ƒæ˜¯**è¡¥å¿è¾¹é™…éšç§æŸå¤±**
2. æ¬¡æ¨¡æ€§è®©å¹³å°å¯ä»¥**å‹ä½ä»·æ ¼**
3. æ¨æ–­å¤–éƒ¨æ€§è®©å¹³å°**ä»ä¸åˆ†äº«è€…è·åˆ©**
4. ç†è®ºæ±‚è§£å™¨å®ç°äº†**Stackelbergå‡è¡¡**

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**ä½œè€…**: AI Assistant  
**æ—¥æœŸ**: 2026-01-15
